# 🚀 릴리즈 노트

## Release 5: 서비스 품질 개선 및 버그 수정 (2025.10.10)

**PRISM-INSIGHT v1.5.3** (PR #49)

### 🎯 변경 목적
서비스 질 상승 및 시스템 안정성 강화

### 🔄 주요 변경사항
**1. 📰 뉴스 에이전트 정확성 개선**
* **프롬프트 고도화**: `firecrawl` 도구를 사용하여 네이버 금융 뉴스 및 공시 페이지에 직접 접속하여 당일 주가 변동 요인을 검색하도록 개선
* **수집 경로**: `https://finance.naver.com/item/news.naver?code={company_code}` URL을 통한 정밀 데이터 수집

**2. 🤖 매매 에이전트 안정화**
* **JSON 파싱 보정 강화**: LLM이 생성한 매매 시나리오 JSON 데이터가 부정확할 경우를 대비한 자동 보정 작업 및 검증 로직 강화
* **파싱 에러 수정**: 구조적 결함이 있는 JSON 응답에 대한 복구 능력 향상

**3. 🐛 메시지 전송 로직 수정**
* **데이터 혼선 방지**: 오전과 오후 트리거가 모두 발생할 경우, 오후 메시지에 오전 데이터가 포함되던 버그 수정
* **독립적 배치 처리**: 각 시간대별 배치 실행 시 데이터 격리 및 메시지 큐 관리 최적화

### 📊 기대 효과
* 뉴스 분석의 신뢰도 및 최신성 확보
* 자동매매 시나리오 생성의 안정성 증대
* 텔레그램 리포트의 정확한 정보 전달

---

## Release 4: AI 기반 시장 분석 강화 및 트레이딩 로직 업그레이드 (2025.09.28)

### 🎯 변경 목적
시장환경과 거시경제를 반영한 매매 신호 제공, AI 프롬프트 기반 로직 전환을 통해 정확도·투명성·유지보수성을 동시에 개선 (PR #34)

### 🔄 주요 변경사항
**1. 📈 시장환경 분석 강화**
* **trading_agent 업그레이드**: 시장환경 및 동종업계 트렌드를 분석에 반영
* **거시경제 통합 분석**: 글로벌 경제 흐름을 고려한 다중 요인 분석으로 매매 신호 정확도 향상

**2. 🤖 AI 프롬프트 기반 로직 전환**
* **규칙 기반 → AI 기반**: 기존의 하드코딩된 매매 로직을 유연한 AI 프롬프트로 이관
* **매도 결정 로직 AI화**: 데이터 기반의 최적 매도 시점 도출 능력 강화 및 코드 단순화

**3. 💬 매매 근거 메시지 보강**
* **상세한 설명 제공**: 매수/매도 사유를 실제 시장 데이터와 함께 상세히 제시
* **투자 보고서 수준**: 분석 리포트 형식으로 메시지를 구성하여 의사결정 과정의 투명성과 신뢰도 강화

**4. 🌍 거시경제 분석 통합**
* **Perplexity-ask 도구 적용**: 실시간 거시경제 동향을 분석 맥락에 즉시 반영
* **비용 및 효율 최적화**: 단일 API 호출로 글로벌 경제 흐름까지 고려한 효율적 데이터 확보

### 🆕 수정된 파일 및 모듈
* **`market_index_agents.py`**: 거시경제 분석 및 지수 분석 기능 추가
* **`trading_agent.py`**: 시장환경 고려 로직 통합 및 프롬프트 고도화
* **`sell_decision_logic.py`**: 규칙 기반 매도 로직을 AI 판단 로직으로 전면 개편
* **매매 근거 메시지 시스템**: 단순 알림에서 전문 분석 리포트 형태로 출력 개선

### 📊 기대 효과
* 시장 상황 변화에 따른 유연한 전략 대응 가능
* 매매 판단의 근거가 명확해져 사용자 신뢰도 향상
* 복잡한 하드코딩 로직 제거로 시스템 유지보수 편의성 증대

---

## Release 3: AI 기반 자동매매 시스템 및 개발자 도구 도입

### 🎯 변경 목적
AI 분석 기반 실제 자동매매 기능 구현 및 개발자 지원 도구 확대

### 🔄 주요 변경사항
**1. 🤖 자동매매 기능 본격 도입**
* **실제 계좌 연동**: 한국투자증권 API를 통한 실제 주식 매매 시스템 구축
* **비동기 매매 엔진**: `AsyncTradingContext`를 활용한 안전한 비동기 주식 거래
* **스마트 매매 전략**: 시간대별 최적 매매 방식 자동 선택 (시장가/지정가/시간외매매/예약주문)
* **포트폴리오 관리**: 실시간 계좌 잔고 조회 및 자동 손익 계산

**2. 📊 매매 에이전트 시스템 강화**
* **에이전트 확장**: 시뮬레이션 매매와 실제 매매 통합 실행 (`stock_tracking_agent.py`, `stock_tracking_enhanced_agent.py`)
* **실시간 매매 로깅**: 매수/매도 성공 여부 및 상세 결과 로깅 시스템 구축

**3. 🔧 개발자 도구 및 테스트 환경 구축**
* **빠른 테스트 도구**: `tests/quick_test.py` - 개별 기능 즉시 테스트
* **종합 테스트 시스템**: `tests/test_async_trading.py` - 전체 매매 시스템 검증
* **포트폴리오 리포터 테스트**: `tests/test_portfolio_reporter.py` - 텔레그램 리포트 기능 검증

**4. 🛡️ 보안 및 안전 기능 강화**
* **모의투자 우선**: 기본값을 모의투자(demo)로 설정하여 안전성 확보
* **이중 확인 시스템**: 실전투자 모드 선택 시 사용자 명시적 확인 절차 추가
* **타임아웃 보호**: 모든 매매 API에 타임아웃 설정으로 무한 대기 방지
* **종목별 락**: 동일 종목 동시 매매 방지를 위한 비동기 락 시스템 도입

### 🆕 신규 파일 및 모듈
* **매매 시스템 핵심**: `trading/domestic_stock_trading.py`, `trading/kis_auth.py`, `trading/config/kis_devlp.yaml.example`
* **테스트 및 검증 도구**: `tests/quick_test.py`, `tests/test_async_trading.py`, `tests/test_portfolio_reporter.py`, `tests/README_async_trading.md`

### 📋 설정 및 환경 개선
**1. 의존성 패키지 추가**
* `PyYAML>=6.0.1`, `pycryptodome>=3.19.0`, `websockets>=12.0`, `cryptography>=42.0.8`

**2. 환경변수 확장**
* `TELEGRAM_AI_BOT_TOKEN`: AI 봇 전용 토큰 추가

**3. .gitignore 보안 강화**
* 매매 관련 보안 정보(KIS 토큰, 키 파일, 설정 파일 등) 제외 설정 강화

### 🎮 사용 방법
**빠른 테스트**
```bash
# 포트폴리오 조회 (모의투자)
python tests/quick_test.py portfolio

# 1만원 매수 테스트 (모의투자)  
python tests/quick_test.py buy

# 전량 매도 테스트 (모의투자)
python tests/quick_test.py sell

# 실전투자 모드 (주의!)
python tests/quick_test.py buy --mode real
```

**종합 테스트**
```bash
# 대화형 테스트 메뉴 실행
python tests/test_async_trading.py
```

### ⚡ 핵심 기능 특징
* **🧠 AI + 실제 매매 연동**: AI 분석 성공 시 실제 계좌에서 자동으로 매매 실행
* **🔄 시간대별 스마트 매매**: 
  * 09:00-15:30: 정규장 시장가 매매
  * 15:40-16:00: 시간외 종가매매
  * 16:00-18:00: 시간외 단일가매매
  * 기타 시간: 예약주문 (다음날 자동 실행)
* **📊 실시간 포트폴리오 관리**: 보유 종목 실시간 조회 및 수익률 자동 계산
* **🛡️ 안전 보장 시스템**: 3단계 보안 락(종목별/세마포어/전역) 및 포괄적 오류 처리

---

## Release 2: 매수 기준 완화 및 모멘텀 전략 강화

### 🎯 변경 목적
기존의 극도로 보수적인 가치투자 방식으로 인해 매수 실행율이 너무 낮아, 좋은 투자 기회들을 과도하게 놓치는 문제를 해결하고자 합니다.

### 🔄 주요 변경사항
**1. 매수 점수 기준 합리화**
* 기본 매수 점수: 8점 → 7점으로 완화
* 포트폴리오 70% 이상 시: 9점 → 8점으로 완화

**2. 프롬프트 개선**
* 에이전트 정체성: "매우 보수적" → "신중하되 모멘텀 고려"
* 매수 점수 해석 기준 조정:
  * 6점: "보통 (모멘텀이 있다면 고려)" 추가
  * 7점: "양호한 매수 기회"로 진입 가능
* 적합성 판단 질문 개선:
  * 기존: "과매도 상태로 매수 적기인가?" (역추세적)
  * 신규: "거래활동 증가나 관심 상승을 보이는가?" (순추세적)

**3. 모멘텀 요소 강화**
* 거래량 급증 시 긍정적 평가
* 투자자별 거래량에서 기관/외인 순매수 시 가산점

### 📊 기대 효과
* 매수 실행율 증가 예상
* 상승 모멘텀 있는 종목들의 기회 포착 개선
* 기존 가치투자 안전장치는 그대로 유지

### ⚠️ 리스크 관리
* 기본적인 재무 건전성, 성장성 검토는 여전히 필수
* 포트폴리오 다양성 제약 조건 유지
* 손절매 시스템 그대로 유지

---

## Release 1: 초기 기능 및 커스터마이징

### 🎯 지원하는 기능
**급등주 포착 조건 예시**
* **거래량 급증** (전일 대비 200% 이상)
* **갭 상승** (5% 이상)
* **시가총액 대비 거래대금 비율**
* **마감 강도 분석**

**분석 보고서 구성**
* **핵심 투자 포인트** - 요약
* **기술적 분석** - 차트 및 지표
* **기본적 분석** - 기업 현황/개요
* **뉴스 분석** - 최근 이슈
* **투자 전략** - 매매 전략

### 🔧 커스터마이징
* **급등주 기준**: `trigger_batch.py`에서 수정 가능
* **AI 프롬프트**: `cores/agents/`에서 에이전트별 수정
* **차트 스타일**: `cores/stock_chart.py`에서 시각화 커스터마이징