# 🚀 릴리즈 노트

## Release 33: 미국 주식 분석 시스템(prism-us) 도입 및 메이저 업데이트 (2026.01.28)

**PRISM-INSIGHT v2.0.0**

### 🎯 개요
PRISM-INSIGHT v2.0.0은 **미국 주식 분석 시스템(prism-us)**을 추가한 메이저 버전입니다. 한국 주식과 동일한 AI 기반 분석 파이프라인을 미국 시장(NYSE, NASDAQ)에 적용하여 S&P 500 및 NASDAQ-100 종목의 급등주 탐지, 심층 분석 리포트 생성, 자동 매매를 지원합니다.
* **주요 수치**: 총 26개 커밋, 79개 파일 변경, 약 22,000 LOC 추가, 221개 테스트 통과(97%).

### 🚀 주요 기능
**1. 미국 주식 분석 시스템 (prism-us) ⭐⭐⭐**
* **전용 아키텍처**: 미국 시장에 최적화된 분석 엔진, 데이터 클라이언트, 차트 생성 및 트레이딩 모듈을 포함하는 `prism-us/` 디렉토리 구조를 새롭게 구축했습니다.
* **MCP 서버 통합**: `yahoo-finance-mcp` 및 `sec-edgar-mcp`를 `uvx` 원격 실행 방식으로 통합하여 로컬 설치 없이 최신 재무 및 공시 데이터를 수집합니다.
* **급등주 탐지**: 시총 $20B 이상, 거래량 200%+, 상승률 5%+ 등 미국 시장 특성에 맞는 선별 기준을 적용했습니다.
* **해외주식 트레이딩**: KIS 해외주식 API를 연동하여 장중/장외 자동 판별 스마트 주문 및 포트폴리오 관리(최대 10종목)를 지원합니다.

**2. 텔레그램 봇 기능 확장 ⭐⭐**
* **미국 주식 명령어**: `/us_evaluate`(보유 종목 평가), `/us_report`(분석 보고서 요청) 명령어를 추가했습니다.
* **투자 일기 시스템 (/journal)**: 사용자의 투자 생각을 기록하고, AI가 종목 평가 시 이를 컨텍스트로 활용하는 기억 시스템을 도입했습니다. (3단계 기억 압축 기술 적용)
* **사용성 개선**: 모든 대화 상태에서 `/cancel` 명령어가 정상 작동하도록 구조를 개선했습니다.

**3. PDF 보고서 "Prism Light" 테마 도입 ⭐**
* 독창적인 스펙트럼 컬러 테마(#667eea → #764ba2)와 세련된 레이아웃을 적용하여 리포트의 시각적 품질을 대폭 향상시켰습니다.
* 한국/미국 모듈 간 마크다운 계층 구조를 통일하여 일관된 리포트 경험을 제공합니다.

**4. 트레이딩 저널 및 원칙 추출 시스템 ⭐⭐**
* 매매 결정을 자동으로 회고하고 반복되는 패턴을 `trading_principles`로 추출하여 시스템의 투자 지능을 축적합니다.
* 과거의 교훈을 바탕으로 AI 에이전트의 매수 점수를 자동으로 보정하는 로직을 추가했습니다.

**5. 예약 주문(Reserved Order) 및 인프라 강화**
* **예약 주문 지원**: 한국(익일/당일) 및 미국(KST 10:00-23:20) 시장의 장외 시간 예약 매매 기능을 구현했습니다.
* **Docker Cron 내장**: 컨테이너 환경에서 `ENABLE_CRON=true` 설정만으로 한국/미국 주식 배치를 자동 실행할 수 있습니다.
* **통합 리포터**: 한국과 미국 주식 포트폴리오 현황을 한 번에 확인할 수 있는 통합 리포트 기능을 제공합니다.

### 📊 개선 효과
| 항목 | 변경 전 | 변경 후 | 효과 |
|------|---------|---------|------|
| **지원 시장** | 한국 (KOSPI/KOSDAQ) | **한국 + 미국 (NYSE/NASDAQ)** | 투자 범위 글로벌 확장 |
| **데이터 수집** | 로컬 라이브러리 의존 | **uvx 기반 MCP 원격 실행** | 설치 간소화 및 데이터 신뢰도 향상 |
| **사용자 기억** | 단발성 대화 | **투자 저널 기반 컨텍스트 유지** | 개인화된 맞춤형 분석 가능 |
| **스케줄링** | 외부 Crontab 의존 | **Docker 내장 Cron 지원** | 배포 및 운영 편의성 극대화 |

### 🔧 기술적 변경사항
* **모델 업그레이드**: 텔레그램 요약 에이전트를 GPT-5.2로 업그레이드하고 `reasoning_effort: none`으로 설정하여 응답 속도를 최적화했습니다.
* **파일명 번역**: 다국어 브로드캐스트 시 PDF 파일명에 번역된 회사명을 사용하도록 개선했습니다.
* **버그 수정**: L2 저널의 우선순위 필드 누락 오류를 수정하고 기본값 적용 로직을 강화했습니다.

### 💡 설정 가이드 (.env / config)
```bash
# 미국 주식 예약 주문 및 스마트 주문 예시
await trader.smart_buy("AAPL", 50000) # 장중 즉시, 장외 예약 자동 판별

# mcp_agent.config.yaml (uvx 원격 실행 설정)
yahoo_finance:
  command: "uvx"
  args: ["--from", "yahoo-finance-mcp", "yahoo-finance-mcp"]
```

---

## Release 32: Trading Agent 매수 프롬프트 개선 및 진입률 향상 (2026.01.16)

**PRISM-INSIGHT v1.16.7**

### 🎯 변경 목적
* **보수적 편향 해결**: GPT-5.2 high reasoning 모델이 과도하게 구체적인 손실 예시로 인해 "안 사는 게 안전하다"고 판단하는 '손실 회피 편향(Loss Aversion Bias)' 문제 해결
* **기회비용 관점 주입**: "다음 기회는 없다"는 시스템 제약사항을 강조하여, 진입하지 않음으로써 발생하는 기회비용(-10% 등)을 인지하도록 유도
* **의사결정 명확화**: 모호한 사유로 진입을 거부하지 못하도록 '미진입 정당화 요건'을 신설하고 용어를 통일하여 판단의 일관성 확보

### 🚀 주요 기능
**1. 손실 회피 프레이밍 제거 및 기회비용 추가 ⭐⭐⭐**
* **프레이밍 전환**: 과도한 손실 복구율 예시 등 공포를 유발하는 문구를 제거하고, "왜 사야 하는가?"에서 **"왜 사면 안 되는가?"**로 판단의 기본 스탠스를 전환했습니다.
* **진입이 기본**: 명확한 부정 요소가 없다면 강세장에서는 진입을 기본값으로 설정하여 예상 진입률을 기존 20~30%에서 **50~60% 수준**으로 향상시켰습니다.

**2. 점수 정의 명확화 및 미진입 요건 신설 ⭐⭐⭐**
* **6점 정의**: 기존의 모호했던 6점 구간을 "조건부 진입(강세장 + 모멘텀 확인 시)"으로 명확히 정의했습니다.
* **정당화 요건**: 강세장에서 진입을 거부하려면 '손절 지지선 -10% 이하' 또는 '업종 평균 대비 PER 2배 이상' 등 구체적인 수치 근거가 반드시 필요하도록 제한했습니다.
* **금지 표현**: "과열 우려", "변곡 신호", "추가 확인 필요" 등 데이터 근거가 부족한 모호한 표현의 사용을 금지했습니다.

**3. 용어 통일: "관망" → "미진입" ⭐**
* 시스템 특성상 트리거 발동 시 단 한 번만 분석하므로, "나중에 다시 보겠다"는 의미의 "관망" 대신 현재 시점의 결정을 나타내는 **"미진입"**으로 용어를 전면 통일했습니다.

**4. 대시보드 UI 업데이트**
* 관심종목 카드 및 종목 상세 모달에 **진입 체크리스트 점수(n/6)**와 **미진입 사유**를 표시하여 AI의 판단 근거를 더 투명하게 확인할 수 있게 되었습니다.

### 📊 개선 효과
| 지표 | v1.16.6 (이전) | v1.16.7 (현재) |
|------|---------------|---------------|
| **손실 프레이밍** | 15회 이상 언급 (보수적) | **제거 (중립적)** |
| **기회비용 언급** | 없음 | **명시적 추가 (적극적)** |
| **미진입 사유** | 모호한 표현 허용 | **구체적 수치 필수** |
| **예상 진입률** | 10건 중 2~3건 | **10건 중 5~6건** |

### 🔧 기술적 변경사항
* **프롬프트 개편**: `cores/agents/trading_agents.py` 내 매수 에이전트 인스트럭션 대폭 수정
* **JSON 스키마 확장**: 응답 형식에 `entry_checklist_passed` 및 `rejection_reason` 필드 추가
* **대시보드 연동**: `generate_dashboard_json.py` 및 프론트엔드 컴포넌트 업데이트

### 💡 판단 예시 (삼성전자)
* **상황**: RSI 90(과매수)이나 외인/기관 3일 연속 순매수 중
* **v1.16.6**: "과열 우려로 추가 확인 필요" → **보류**
* **v1.16.7**: "RSI가 높으나 수급이 강력하여 미진입 복합 조건을 충족하지 않음" → **진입**

---

## Release 31: trigger_batch 종목 선별 기준 개편 (연평균 15% 수익 시스템) (2026.01.14)

**PRISM-INSIGHT v1.16.6**

### 🎯 변경 목적
* **정합성 확보**: `trigger_batch`의 선별 로직과 `trading_agent`의 진입 기준(-5%~-7% 손절)을 일치시켜 모멘텀 강한 종목이 거부당하는 역설적 상황 해결
* **수익 목표 설정**: 모든 시장 상황에서 연평균 15% 수익 달성을 목표로 하는 안정적인 시스템 구조 확립
* **유동성 리스크 관리**: 시가총액 기준 상향을 통해 기관 및 외국인의 관심도가 높은 우량 종목 위주로 선별

### 🚀 주요 기능
**1. 고정 손절폭 방식 도입 ⭐⭐⭐**
* **기존 문제**: 10일 지지선 기반 계산 시 급등주에서 과도한 손절폭(40%+)이 발생하여 에이전트가 진입을 거부함.
* **해결 방법**: 트리거 유형별로 현재가 기준 고정 비율(-5% 또는 -7%)을 적용하여 에이전트의 진입 기준을 항상 충족하도록 개선했습니다.

**2. 트리거 유형별 손절폭 기준 동기화 ⭐⭐**
* `trading_agents.py`의 로직과 완벽히 동기화된 기준을 적용합니다.
* 거래량 급증, 갭 상승, 일중 상승률 등 모멘텀 트리거: **손절폭 5% / 손익비 1.2+**
* 횡보주 트리거: **손절폭 7% / 손익비 1.5+**

**3. 시총 필터 상향 및 등락률 상한선 신설 ⭐**
* **시총 기준**: 3,000억 → **5,000억 이상**으로 상향하여 소형주 유동성 리스크를 배제했습니다. (대상 종목 약 518개)
* **등락률 상한**: 전일 대비 **20% 이하** 종목만 선별하여 상한가 근접 및 단기 과열 종목에 대한 추격 매수 리스크를 방지합니다.

**4. 목표가 최소 +15% 보장 및 점수 계산 간소화**
* 저항선이 낮게 형성된 경우에도 최소 +15%의 목표가를 설정하여 최소 손익비 2.0 이상을 확보합니다.
* 고정 손절폭 적용에 따라 `agent_fit_score` 계산 로직을 단순화하여 시스템 부하를 줄였습니다.

### 📊 개선 효과
| 지표 | v1.16.5 (이전) | v1.16.6 (현재) |
|------|---------------|---------------|
| **손절가 계산** | 10일 지지선 기준 | **현재가 × 고정비율** |
| **손절폭** | 0% ~ 50%+ (가변) | **5% ~ 7% (고정)** |
| **시총 필터** | 3,000억+ (734개) | **5,000억+ (518개)** |
| **등락률 필터** | 없음 | **20% 이하** |
| **agent_fit_score** | 0.03 ~ 0.9 (불안정) | **0.7 ~ 1.0 (안정)** |

### 📈 연평균 15% 달성 시뮬레이션 (10슬롯 기준)
* **포트폴리오 구조**: 10개 슬롯(각 10%), 월 2회 회전(평균 보유 15일), 연간 총 240회 진입.
* **기대 수익 구조**:
    * 손절(35% 확률): -5%
    * 본전(15% 확률): 0%
    * 익절(50% 확률): +12% (목표 +10~15%)
* **월간 기대치**: 약 +4.25% → 현실적 할인 후 **월 2% 순수익** 목표.
* **연환산 수익률**: 월 2% 복리 적용 시 약 26.8% → 거래 비용 및 시장 변동성 고려 시 **최종 15% 이상** 달성 가능.

---

## Release 30: 매수 에이전트 프롬프트 개선 및 시스템 제약사항 명시 (2026.01.13)

**PRISM-INSIGHT v1.16.5**

### 🎯 변경 목적
* **의사결정 일관성 확보**: LLM이 시스템의 특성(관심목록 추적 불가, 단회성 분석)을 명확히 인지하여 실현 가능한 매매 결정을 내리도록 유도
* **기회 손실 방지**: 강세장에서 손익비(R/R)를 절대적 장벽이 아닌 참고 지표로 활용하여 유연한 진입 허용
* **트리거 최적화**: 트리거 유형별로 차별화된 진입 기준을 적용하여 분석의 정교함 향상

### 🚀 주요 기능
**1. 시스템 제약사항 섹션 신설 ⭐⭐⭐**
* 프롬프트 최상단에 시스템의 한계를 명시하여 "조건부 관망" 결정을 원천 차단했습니다.
* "지지 확인 후 진입", "눌림 시 재진입" 등 추적 기능이 필요한 표현 사용을 금지하고 오직 "지금"의 진입 여부만 판단하도록 개선했습니다.
* 분할매매 불가 및 올인/올아웃 방식의 신중함을 다시 한번 강조했습니다.

**2. 트리거 유형별 진입 기준 도입 (강세장 전용) ⭐⭐⭐**
* 강세장에서는 모멘텀 강도와 추세 방향을 손익비보다 우선 고려합니다.
* 거래량 급증, 갭 상승, 일중 상승률 상위 등 트리거 유형에 따라 최소 손익비 기준을 1.2~1.5로 세분화하여 적용합니다.

**3. 에이전트에게 트리거 정보 전달 강화 ⭐⭐**
* `stock_tracking_agent.py`에서 분석 대상 종목이 어떤 트리거(유형 및 시간대)에 의해 포착되었는지 에이전트에게 전달하여 상황에 맞는 판단을 내리게 합니다.

**4. 손절 규칙의 엄격한 체계화**
* 시장 환경 및 손익비 수준에 따라 손절폭을 -5%에서 -7% 사이로 정교하게 관리합니다.
* 특히 강세장에서 손익비가 낮을 경우(-1.5 미만) 더 타이트한 손절(-5%)을 적용하여 리스크를 방어합니다.

### 🔧 기술적 변경사항
* **프롬프트 최적화**: 불필요한 이모티콘을 제거하여 토큰 효율을 높이고 영어/한국어 지침의 동기화를 완료했습니다.
* **데이터 파이프라인**: `trigger_type` 및 `trigger_mode`를 LLM 컨텍스트에 포함시키는 로직을 반영했습니다.

### 📊 개선 효과
| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| **조건부 관망** | 허용됨 (의미 없는 결정) | **금지 (명시적 차단)** |
| **강세장 손익비** | 절대적 진입 장벽 | **유연한 참고 기준** |
| **트리거 정보** | 에이전트 인지 불가 | **판단 근거로 활용** |
| **시스템 제약** | 프롬프트 내 분산됨 | **최상단 통합 명시** |

### 💡 강세장 트리거별 가이드라인
| 트리거 유형 | 손익비 참고 | 손절폭 | 우선 판단 요소 |
|------------|-----------|-------|--------------|
| 거래량 급증 | 1.2+ | -5% | 모멘텀, 추세 |
| 갭 상승 | 1.2+ | -5% | 갭 강도 |
| 일중 상승률 | 1.2+ | -5% | 상승 강도 |
| 마감 강도 | 1.3+ | -5% | 패턴, 수급 |
| 자금 유입 | 1.3+ | -5% | 자금 집중도 |
| 거래량 증가 횡보 | 1.5+ | -7% | 매집 신호 |

---

## Release 29: 시장 환경별 진입 기준 차별화 및 범용 매매 원칙 시스템 도입 (2026.01.12)

**PRISM-INSIGHT v1.16.3**

### 🎯 변경 목적
* **기회 비용 최소화**: 강세장에서도 약세장과 동일한 보수적 기준을 적용하여 발생하던 FOMO(현금비중 과다) 현상을 해결하기 위해 시장 환경별 진입 기준 차별화
* **투자 지능의 범용화**: 종목별로 파편화되어 있던 매매 교훈(lessons)을 범용 원칙(Universal Principles)으로 추출하여 모든 매매 결정의 컨텍스트로 활용
* **시스템 지속 가능성 확보**: 데이터 무한 누적을 방지하는 정리(Cleanup) 시스템과 토큰 제한 로직을 도입하여 장기 운영 안정성 강화
* **성과 분석 투명성**: 실제 매매 종목의 트리거 유형 추적 및 대시보드 내 '인사이트' 탭 신설을 통한 다각도 성과 시각화

### 🚀 주요 기능
**1. 시장 환경별 진입 기준 차별화 (Market-Adaptive Entry) ⭐⭐⭐**
* **판단 기준**: KOSPI 20일 이평선 상회 및 최근 2주 5% 이상 상승 시 '강세장'으로 판단합니다.
* **기준 완화**: 강세장에서는 손익비 기준을 1.5로, 손절폭을 10%로 완화하여 진입 기회를 확대합니다. (약세장은 기존 보수적 기준 유지)
* **트리거 연동**: `trigger_batch.py`의 점수 계산 로직도 시장 환경에 맞춰 유연하게 조정됩니다.

**2. Trading Journal Memory 구조 개편 (Universal Principles) ⭐⭐⭐**
* **범용 원칙 시스템**: `trading_principles` 테이블을 신설하여 고우선순위 교훈을 모든 매매에 적용되는 원칙으로 관리합니다.
* **지능형 컨텍스트**: 매수 결정 시 범용 원칙 → 동일 종목 이력 → 동일 섹터 거래 → 축적 직관 순으로 AI에게 최적의 정보를 제공합니다.

**3. 토큰 누적 방지 및 정리 시스템 (Cleanup & Limits) ⭐⭐**
* **입력 제한**: AI에게 전달되는 과거 이력의 개수를 제한(LIMIT)하여 토큰 낭비를 막고 분석 효율을 높였습니다.
* **자동 정리**: 90일간 검증되지 않거나 신뢰도가 낮은(0.3 미만) 원칙/직관을 자동으로 비활성화하는 `cleanup_stale_data()` 기능을 추가했습니다.

**4. Trading Insights 대시보드 통합 ⭐⭐**
* **💡 인사이트 탭 신설**: 트리거 성과 분석, 범용 원칙 시각화, 아코디언 UI 기반 매매일지, 축적 직관을 한눈에 확인할 수 있습니다.
* **상세 분석**: 손익비 구간별 성과, 놓친 기회(관망 후 급등), 회피한 손실(관망 후 급락) 등 데이터 기반의 전략 개선 지표를 제공합니다.

**5. 실제 매매 종목 트리거 유형 추적**
* `stock_holdings` 및 `trading_history` 테이블에 트리거 정보 컬럼을 추가하여, 실제 매매가 어떤 알고리즘에서 기인했는지 성과를 측정합니다.

### 🔧 기술적 변경사항
* **스키마 변경**: `stock_holdings`, `trading_history`에 `trigger_type`, `trigger_mode` 컬럼 자동 추가
* **스크립트 통합**: `compress_trading_memory.py`에 cleanup 단계 통합 실행 로직 반영
* **데이터 마이그레이션**: 기존 교훈과 성과 데이터를 신규 시스템으로 이전하는 유틸리티 스크립트 2종 제공

### 📊 시장별 진입 기준 비교
| 기준 | 강세장 | 약세장/횡보장 |
|------|--------|---------------|
| **최소 손익비** | 1.5 | 2.0 |
| **최대 손절폭** | 10% | 7% |
| **최소 진입 점수** | 6점 | 7점 |

### 💡 업데이트 및 마이그레이션 방법
```bash
git pull
pip install -r requirements.txt

# 1. 기존 교훈 → 범용 원칙 추출 (최초 1회)
python utils/migrate_lessons_to_principles.py

# 2. 기존 데이터 → 성과 추적기 마이그레이션 (권장)
python utils/migrate_watchlist_to_performance_tracker.py
```

### ⏰ Crontab 설정 업데이트
```bash
# 성과 추적 가격 업데이트 (매일 17:00)
0 17 * * 1-5 cd /path/to/prism-insight && python performance_tracker_batch.py >> logs/performance_tracker.log 2>&1

# 대시보드 JSON 생성 (매일 17:05)
5 17 * * 1-5 cd /path/to/prism-insight && python examples/generate_dashboard_json.py >> logs/dashboard_gen.log 2>&1

# 매주 일요일 새벽 3시에 압축 + 정리 실행
0 3 * * 0 cd /path/to/prism-insight && python compress_trading_memory.py >> logs/compression.log 2>&1
```

### ⚠️ 알려진 제한사항
* 실제 매매 종목의 트리거 유형별 성과 측정은 데이터 수집이 시작된 **2026.01.12 기록부터** 대시보드에 반영됩니다.
* Cleanup 기능은 데이터를 완전 삭제하지 않고 `is_active=0`으로 비활성화 처리합니다. (Layer 3 저널 제외)

---

## Release 28: KRX 로그인 최적화 및 하이브리드 선별 후보 확장 (2026.01.06)

**PRISM-INSIGHT v1.15.1**

### 🎯 변경 목적
* **로그인 부하 감소**: 분석 파이프라인 실행 시 발생하는 과도한 KRX 로그인 횟수(14회+)를 1~2회로 최적화하여 계정 차단 리스크 방지 및 속도 향상
* **종목 선별 품질 향상**: 하이브리드 선별 후보군을 넓혀 AI 에이전트의 매매 기준에 더 부합하는 종목 포착
* **데이터 호환성 확보**: pykrx와 동일한 영문 컬럼명을 사용하여 코드 안정성 확보 및 세션 관리 자동화

### 🚀 주요 기능
**1. KRX 로그인 최적화 (Single Login Architecture) ⭐⭐⭐**
* **파일 락(File Lock)** 기반 동시 로그인 방지 로직을 도입하여 병렬 처리 시에도 단일 세션을 안전하게 공유합니다.
* **세션 신선도(Freshness) 추적**: 5분 이내에 검증된 세션은 재검증 없이 즉시 사용하여 API 호출 효율을 높였습니다.
* **ISIN 캐시 공유**: 종목코드-ISIN 매핑 정보를 `~/.krx_isin_cache.json`에 저장하고 12시간 동안 프로세스 간 공유합니다.
* **쿠키 도메인 수정**: 쿠키 범위를 `.krx.co.kr` 전체로 확장하여 세션 유지력을 강화했습니다.

**2. 하이브리드 선별 후보 확장 (3개 → 10개) ⭐⭐**
* 각 트리거별 후보 수를 10개로 확대하여 매수/매도 에이전트의 손익비 및 손절폭 기준에 최적화된 종목이 선별될 확률을 높였습니다.
* 후보 풀이 넓어짐에 따라 에이전트의 매매 승인율이 향상될 것으로 기대됩니다.

**3. pykrx 호환성 및 세션 관리 개선 ⭐**
* **영문 컬럼명 통일**: DataFrame 컬럼명을 `Open`, `High`, `Low`, `Close`, `Volume`, `Amount`로 수정하여 기존 코드와의 호환성을 높이고 `KeyError`를 방지했습니다.
* **세션 관리 추상화**: `krx_data_client` 내부에서 세션을 자동으로 관리하도록 개선하여 클라이언트 코드에서 별도의 세션 검증 호출이 필요 없게 되었습니다.

### 🔧 기술적 변경사항
* **실행 방식 변경**: `trigger_batch.py`를 subprocess가 아닌 직접 import 방식으로 호출하여 메인 프로세스와 세션을 공유합니다.
* **서버 업그레이드**: `kospi-kosdaq-stock-server` v0.3.20 버전이 적용되었습니다.

### 📊 개선 효과
| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| **카카오 로그인 횟수** | 14회+ | **1~2회** |
| **ISIN 캐시 구축** | 매 프로세스 | **12시간 1회** |
| **세션 검증** | 매 API 호출 | **5분 1회** |
| **하이브리드 후보 수** | 3개 | **10개** |

### 💡 업데이트 방법
```bash
git pull
pip install -r requirements.txt
```

### ⚠️ 알려진 제한사항
* KRX 세션은 약 6~7분 후 만료되도록 설계되어 있어, 장시간 분석 시 자동으로 재로그인이 발생할 수 있습니다.

---

## Release 27: KRX 데이터 수집 방식 혁신 및 하이브리드 트리거 도입 (2026.01.05)

**PRISM-INSIGHT v1.15.0**

### 🎯 변경 목적
* **데이터 수집 안정성 확보**: KRX 거래소의 로그인 시스템 도입에 대응하여 기존 `pykrx` 대신 자체 로그인 크롤링 방식(`krx_data_client`)으로 전면 전환
* **종목 선정 정교화**: 단순 급등주 선별에서 벗어나 AI 에이전트의 매매 로직(손익비, 손절폭)과 궁합이 좋은 종목을 찾는 하이브리드 선별 방식 도입
* **의사결정 품질 향상**: 매매 복기 및 장기 기억 압축 시스템을 통해 과거 패턴을 학습하고 투자 직관을 축적하는 기반 마련

### 🚀 주요 기능
**1. KRX 데이터 수집 방식 변경 (Breaking Change) ⭐⭐⭐**
* **자체 크롤링 전환**: `pykrx` 사용이 제한됨에 따라 `kospi-kosdaq` MCP 서버의 자체 크롤링 기능을 라이브러리화하여 통합했습니다.
* **카카오 로그인 적용**: 투자자별 거래동향 등 고품질 데이터 확보를 위해 카카오 계정 기반의 로그인 세션을 사용합니다.
* **인증 안내**: 2단계 인증 사용 시 분석마다 카카오 앱 확인이 필요하므로, 원활한 자동화를 위해 2단계 인증 해제를 권장합니다.

**2. 트리거 선정 알고리즘 개선 (Hybrid Selection) ⭐⭐⭐**
* **에이전트 적합도 평가**: "오늘 가장 많이 움직인 종목"이 아닌 "AI 에이전트가 실제로 진입하기 좋은 종목"을 우선순위에 둡니다.
* **하이브리드 스코어링**: 10일간의 데이터를 분석하여 손익비(Risk/Reward ≥ 2.0)와 손절폭(≤ 7%)을 계산하고 기존 복합점수와 결합합니다.
    * **최종 점수** = 복합점수(40%) + 에이전트점수(60%)
* **기대 효과**: 이미 너무 급등하여 손절가가 먼 종목을 사전에 걸러내어 AI 에이전트의 매매 승인율을 높입니다.

**3. 매매일지(Trading Journal) 에이전트 추가 (Optional) ⭐⭐**
* **복기 및 학습**: 매 거래 종료 시 AI가 매수/매도 맥락을 비교 분석하여 실행 가능한 교훈을 추출합니다.
* **계층적 기억 압축**: 최신 기록은 상세히 보관하고, 오래된 기록은 요약 및 직관(Intuition) 형태로 압축하여 장기 기억으로 전환합니다.
* **선택적 활성화**: `.env` 설정을 통해 기능을 켜거나 끌 수 있어 기존 사용자 환경에 영향을 주지 않습니다.

### 🔧 기술적 변경사항
* **데이터 클라이언트**: `pykrx` 의존성을 제거하고 `kospi-kosdaq` 리포지토리 참조 방식으로 변경
* **트리거 로직**: `trigger_batch.py`에 10일 OHLCV 기반 에이전트 점수 계산 로직 추가
* **메모리 아키텍처**: `Mem0` 논문 및 에피소딕 기억 구조를 참고한 Layer 1→2→3 기억 압축 알고리즘 적용

### 📊 하이브리드 선별 효과 예시
| 종목 유형 | 복합점수 | 에이전트점수 | 최종점수 | 결과 |
|-----------|----------|--------------|----------|------|
| **A (단순 급등주)** | 0.70 | 0.03 | 0.42 | **탈락** (손절폭 25%로 과다) |
| **B (안정적 돌파주)** | 0.57 | 0.85 | **0.53** | **선택** (손익비 3.36, 손절폭 2.6%) |

### 💡 설정 가이드 (.env)
```bash
# KRX 데이터 수집용 (필수)
KAKAO_ID=your_kakao_email@example.com
KAKAO_PW=your_kakao_password

# 매매일지 활성화 (선택)
ENABLE_TRADING_JOURNAL=true
```

### 📚 참고 문헌
* *Mem0: Building Production-Ready AI Agents with Scalable Long-Term Memory (2025)*
* *Human-inspired Episodic Memory for Infinite Context LLMs (2024)*
* *Memory in the Age of AI Agents: A Survey (2025)*

---

## Release 26: AI 모델 업그레이드 및 모의투자 장외 예약 주문 도입 (2025.12.30)

**PRISM-INSIGHT v1.14.0** (PR #133, #134, #135, #136)

### 🎯 변경 목적
* **비용 및 성능 최적화**: 최신 모델 전환과 함께 분석 범위를 효율화하여 API 비용 절감 및 속도 향상
* **모의투자 안정성 확보**: 장외 시간 BUY 시그널 발생 시 발생하는 에러를 예약 시스템으로 해결
* **데이터 시각화 정교화**: 투자자 유형 매핑 확장 및 수급 분석 기간 최적화로 분석 정확도 개선

### 🚀 주요 기능
**1. AI 모델 고도화 및 비용 최적화 ⭐⭐⭐**
* **GPT-5.2 업그레이드**: 리포트 생성 엔진의 모든 모델을 GPT-4.1에서 GPT-5.2로 업그레이드했습니다.
* **추론 오버헤드 제거**: `reasoning_effort="none"` 설정을 통해 불필요한 추론 비용과 시간을 단축했습니다.
* **분석 범위 최적화**: 주가 차트 분석 범위를 2년에서 1년으로, 섹션별 출력 글자수를 3,000자로 제한하여 토큰 사용량을 최적화했습니다.

**2. 모의투자 장외 예약 주문 시스템 도입 ⭐⭐⭐**
* **IGW00009 에러 해결**: 모의투자에서 지원하지 않는 장외 예약주문 API 문제를 `ScheduledOrderManager`를 통한 자체 스케줄링 방식으로 해결했습니다.
* **자동 실행**: 장외(16:00 이후)에 발생한 BUY 시그널을 저장했다가, **다음 영업일 09:05**에 자동으로 시장가 매수를 실행합니다.
* **영속성 유지**: 예약된 주문은 `logs/scheduled_orders.json`에 저장되어 시스템 재시작 시에도 유지됩니다.

**3. 리포트 생성 성능 및 시각화 개선 ⭐⭐**
* **병렬 처리 옵션**: `PRISM_PARALLEL_REPORT` 환경변수를 통해 6개 섹션의 동시 생성이 가능해졌습니다. (기본값은 API 안정성을 위해 false)
* **투자자 매핑 확장**: 거래량 차트의 투자자 유형 매핑을 4개에서 11개(보험, 투신, 사모, 연기금 등)로 확장하여 한글 깨짐 현상을 수정했습니다.
* **수급 분석 기간 조정**: 수급 분석 조회 기간을 2년에서 30일로 단축하여 최근의 매집/이탈 패턴을 더 정확하게 반영합니다.

### 🔧 기술적 변경사항 및 버그 수정
* **에러 처리 강화**: 예약주문 실패 시 1초의 대기 시간(fallback)을 추가하여 API Rate Limit 위반을 방지합니다.
* **파일명 정규화**: 리포트 생성 시 출력 파일명이 일관된 형식을 갖도록 수정했습니다.
* **유틸리티 추가**: `is_market_hours()`, `get_next_market_open()` 등 시장 시간 판단 로직을 공통 모듈화했습니다.

### 📊 개선 효과
| 항목 | 변경 전 | 변경 후 | 효과 |
|------|---------|---------|------|
| **핵심 모델** | GPT-4.1 | **GPT-5.2** | 분석 품질 및 추론 능력 향상 |
| **리포트 생성** | 순차 실행 | **병렬 실행 지원** | 생성 속도 최대 5배 향상 가능 |
| **장외 주문** | 에러 발생 | **익일 자동 예약** | 모의투자 운영 연속성 확보 |
| **API 비용** | 2년치 데이터 | **1년치 데이터** | 토큰 소모량 및 비용 약 40% 절감 |

### 💡 설정 가이드 (.env)
```bash
# 리포트 병렬 생성 여부 (true 설정 시 속도 향상, 단 API 한도 주의)
PRISM_PARALLEL_REPORT=false
```

---

## Release 25: 트레이딩 성과 지표 고도화 및 리스크 관리 강화 (2025.12.12)

**PRISM-INSIGHT v1.13.1** (PR #115, #116, #117, #118, #119, #120, #121)

### 🎯 변경 목적
* **성과 분석 전문성 강화**: Profit Factor, Sharpe Ratio 등 전문적인 트레이딩 지표를 도입하여 다각도 분석 지원
* **데이터 신뢰도 확보**: 리스크 조정 수익률 지표의 계산 공식을 정교화하여 분석 오류 수정
* **사용자 편의성 및 가독성 개선**: 지표 설명 툴팁 추가 및 포트폴리오 안정성 시각화 강화

### 🚀 주요 기능
**1. 트레이딩 성과 지표 대폭 개선 ⭐⭐⭐**
* **상세 성과 지표 추가 (#118)**: 평균 수익/손실률 분리 표시, **Profit Factor**(총 수익/총 손실), **손익비**(평균 수익/평균 손실), 최대 연승 기록 등 추가.
* **리스크 조정 수익률 지표 도입 (#119)**: **Alpha**(벤치마크 대비 초과수익), **Beta**(시장 변동성 대비), **Sharpe Ratio**(위험 조정 수익률), **Information Ratio**(추적 오차 대비 초과수익) 추가.
* **지표 설명 툴팁 (#120)**: 7개 주요 성과 지표에 대한 상세 설명과 기준값(좋음/보통/나쁨) 색상 표시 기능 추가.

**2. 포트폴리오 안정성 및 현금 관리 강화 ⭐⭐**
* **안정성 카드 도입 (#116)**: 기존 수익 분포 카드를 '현금 및 포트폴리오 안정성' 카드로 교체하여 리스크 관리 직관성 향상.
* **예수금 관리 정교화**: 실전 투자 요약 및 리포트에 예수금(deposit) 필드를 명시적으로 사용하도록 수정 (#115).

**3. 다국어 지원 및 기술적 개선 ⭐**
* 한국어/영어 28개 번역 키를 추가하여 다국어 대시보드 지원 강화.
* 시뮬레이터 보유종목 테이블의 섹터 표시 fallback 메커니즘 추가.

### 🔧 기술적 변경사항 및 버그 수정
* **리스크 조정 지표 계산 오류 수정 (#121)**:
    * **Alpha**: 잘못된 CAPM 공식 대신 단순 초과수익률(Prism - Market)로 수정 (수정 전: +11.54% → 수정 후: -11.51%).
    * **Beta**: 일별 수익률 단위 일관성 확보.
    * **Sharpe Ratio**: 연율화 계산 오류 수정.
    * **Information Ratio**: 연율화된 알파 및 추적 오차 기반으로 수정.
* **로깅 설정 개선 (#117)**: `generate_dashboard_json.py`에서 root logger 대신 named logger를 사용하여 로그 관리 효율화.

### 📊 성과 지표 요약 (시즌 2 기준)
| 지표 | 설명 | 평가 기준 |
|------|------|-----------|
| **Profit Factor** | 총 수익 / 총 손실 | 1.5 이상 (양호), 2.0 이상 (우수) |
| **Sharpe Ratio** | 위험 대비 수익성 | 1.0 이상 (양호), 2.0 이상 (매우 우수) |
| **Alpha** | 시장 대비 초과 수익 | 0보다 크면 시장 수익률 상회 |
| **Beta** | 시장 민감도 | 1보다 작으면 시장보다 변동성 낮음 |

### 📈 기대 효과
* **정밀한 전략 평가**: 단순 수익률을 넘어 리스크 대비 효율성을 객관적으로 평가 가능
* **리스크 관리 최적화**: 포트폴리오 안정성 지표를 통해 하락장 대응 능력 강화
* **글로벌 확장성**: 강화된 다국어 지원으로 해외 사용자 접근성 향상

---

## Release 24: OpenAI 모델 업그레이드 및 Season 2 트래킹 강화 (2025.12.12)

**PRISM-INSIGHT v1.13.0** (PR #113, #114)

### 🎯 변경 목적
* **분석 품질 향상**: 최신 GPT-5.2 모델을 적용하여 AI 에이전트의 추론 및 의사결정 능력 강화
* **사용자 경험 개선**: 이미 보유 중인 종목에 대한 중복 알림을 제거하여 메시지 혼란 방지
* **성과 추적 정교화**: Season 2 수익률 및 현금 비중 등 핵심 지표를 추가하여 포트폴리오 현황 파악 개선

### 🚀 주요 기능
**1. OpenAI 모델 업그레이드 (GPT-5.2) ⭐⭐⭐**
* Trading Agents의 기본 모델을 **GPT-5.1에서 GPT-5.2로 업그레이드**했습니다.
* 모델 변경에 따른 프롬프트 최적화로 더욱 정확하고 일관된 매매 의사결정을 지원합니다.

**2. 텔레그램 메시지 및 로직 개선 ⭐⭐**
* **보유종목 메시지 정리**: 이미 보유 중인 종목에 대해 "매수 보류" 메시지가 발송되던 문제를 해결하여 불필요한 알림을 제거했습니다.
* **데이터 반환 수정**: `analyze_report()`에서 보유 종목의 `current_price`를 반환하도록 개선했습니다.
* **오타 수정**: "Hold 중" 표기를 "보유 중"으로 수정하여 가독성을 높였습니다.

**3. 포트폴리오 리포터 강화 (Season 2) ⭐⭐⭐**
* **Season 2 트래킹**: 2025.09.29(시작 금액 9,969,801원) 기준의 시즌 성과 추적 기능을 추가했습니다.
* **자산 표시 개선**: 평가금액만 표시하던 방식에서 '평가금액 + 현금' 합계인 **총 자산** 표시 방식으로 변경했습니다.
* **현금 비중 표시**: 리스크 관리를 위해 포트폴리오 내 현금 비율을 실시간으로 확인할 수 있습니다.

### 📊 텔레그램 메시지 개선 예시
**[Before]**
> 📊 포트폴리오 현황
> 평가금액: 12,500,000원
> 평가손익: +2,530,199원 (+25.4%)

**[After]**
> 📊 포트폴리오 현황
> **총 자산: 12,500,000원 (평가 + 현금)**
> **현금 비중: 15.2%**
>
> 📈 **Season 2 성과**
> 시작: 2025.09.29 / 9,969,801원
> 시즌 수익: +2,530,199원 (+25.4%)
>
> 💼 보유종목 평가손익: +1,850,000원 (+18.5%)

### 🔧 기술적 변경사항
| 파일 | 변경 내용 |
|------|-----------|
| `cores/agents/trading_agents.py` | GPT-5.2 모델 적용 및 프롬프트 업데이트 |
| `cores/agents/stock_tracking_agent.py` | 보유종목 `current_price` 반환 로직 추가 |
| `cores/agents/stock_tracking_enhanced_agent.py` | 보유종목 메시지 생략 로직 구현 및 용어 수정 |
| `cores/trading/portfolio_telegram_reporter.py` | Season 2 상수 추가 및 리포트 UI 개편 |

### 📈 기대 효과
* **명확한 정보 전달**: 중복 알림 제거와 시즌 성과 지표 추가로 사용자가 상황을 한눈에 파악 가능
* **리스크 관리 용이**: 현금 비중 확인을 통해 시장 상황에 따른 대응 전략 수립 지원
* **판단 정확도 향상**: GPT-5.2의 향상된 추론 능력을 통해 고도화된 매매 시나리오 생성

### ⚠️ 주의사항
* **Season 2 상수 관리**: 시작일과 시작 금액이 코드에 포함되어 있으므로, 차기 시즌 시작 시 해당 값의 업데이트가 필요합니다.
* **API 비용 모니터링**: GPT-5.2 모델 적용에 따른 API 사용 비용 및 응답 속도 변화에 대한 모니터링을 권장합니다.

---

## Release 23: 윌리엄 오닐 페르소나 주입 및 손익비 검증 시스템 도입 (2025.12.08)

**PRISM-INSIGHT v1.12.3** (PR #111)

### 🎯 변경 목적
* **투자 철학 확립**: AI 에이전트에 명확한 투자 철학 부여 (윌리엄 오닐의 CAN SLIM)
* **리스크 관리 강화**: 나쁜 진입 차단 및 큰 손실 방지 (손익비 2:1 미만 자동 관망)
* **수익 극대화**: Trailing Stop 자동화로 강세장에서의 큰 추세 수익 확보
* **투명성 제고**: 대시보드에 손익비 지표를 표시하여 의사결정 근거 시각화

### 🚀 주요 기능
**1. 윌리엄 오닐 페르소나 주입 ⭐⭐⭐**
* CAN SLIM 시스템 창시자의 투자 철학을 AI 에이전트에 적용했습니다.
* 핵심 원칙: "손실은 7-8%에서 짧게 자르고, 수익은 길게 가져가라"
* 100% 올인/올아웃 시스템에 최적화된 리스크 관리 체계를 구축했습니다.

**2. 손익비(Risk/Reward Ratio) 검증 시스템 ⭐⭐⭐**
* **매수 에이전트**: 모든 진입 전 손익비를 필수 계산하며, **손익비 ≥ 2.0** 및 **예상 손실률 ≤ 7%** 기준 미달 시 자동으로 "관망" 결정을 내립니다.
* **예시**: 
    * 부적합: 목표 +16.7%, 손절 -13.9% (손익비 1.2) ❌ → **관망**
    * 적합: 목표 +30%, 손절 -7% (손익비 4.3) ✅ → **진입**

**3. 손절 규칙 엄격화 및 Trailing Stop 자동화 ⭐⭐**
* **매도 에이전트**: 손실 -7.1% 이상 시 예외 없이 자동 매도를 실행합니다. (단, 당일 강한 반등 및 수급 확인 시 1일 유예 가능)
* **수익 극대화**: 진입 후 최고가를 지속 추적하여 자동으로 손절가를 상향 조정합니다. (강세장: 고점 대비 -8%, 약세장: -5%)

**4. 대시보드 UI 개선**
* 종목 상세 모달 및 관망 리스트에 **Risk/Reward Ratio(손익비)**, **Expected Return**, **Expected Loss** 지표를 추가했습니다.
* 손익비에 따른 색상 코드 적용: 3.0+(초록, 우수), 2.0-3.0(회색, 보통), 2.0 미만(빨간, 경고).

### 📊 개선 효과
| 지표 | 개선 전 | 개선 후 | 효과 |
|------|---------|---------|------|
| 평균 수익률 | +15% | +25~30% | **+67~100%** |
| 평균 손실 | -8% | -5% | **-37.5%** |
| 손익비 | 1.9 | 5.0+ | **+163%** |
| MDD | -25% | -12% | **-52%** |
* **나쁜 진입 50% 차단**: 손익비 검증으로 불리한 진입을 사전에 방지합니다.
* **큰 손실 80% 방지**: 엄격한 -7% 손절로 치명적 손실을 방지합니다.

### 🔧 기술적 변경사항
* **Backend**: `cores/agents/trading_agents.py`에 윌리엄 오닐 페르소나 및 손익비 검증 로직 추가. JSON 응답에 `risk_reward_ratio`, `expected_return_pct`, `expected_loss_pct` 필드 추가.
* **Frontend**: `stock-detail-modal.tsx`, `watchlist-page.tsx`에 지표 표시 로직 추가 및 `language-provider.tsx` 번역 데이터 업데이트.

### 🎓 투자 철학 배경: CAN SLIM
| 요소 | 의미 | 기준 |
|------|------|------|
| **C** | Current Earnings | 현재 분기 EPS 25%+ 성장 |
| **A** | Annual Earnings | 연간 이익 3년간 25%+ 성장 |
| **N** | New | 신제품/신경영진/신고가 |
| **S** | Supply & Demand | 기관 매집 + 적정 유통주식 |
| **L** | Leader | 업종 선도주 (RS 80+) |
| **I** | Institutional | 우량 기관의 후원 |
| **M** | Market Direction | 시장 추세에 순응 |

### 💡 사용자 가이드
* **대시보드 확인**: 종목 클릭 시 나타나는 상세 모달에서 "Risk/Reward Ratio" 섹션을 확인하세요.
* **색상 코드**:
    * **초록색 (3.0+)**: 우수한 위험 대비 보상 비율을 가진 진입 기회입니다.
    * **회색 (2.0-3.0)**: 적절한 진입 기회입니다.
    * **빨간색 (2.0 미만)**: 손실 위험이 보상보다 큽니다. 관망을 권장합니다.

### ⚠️ 주의사항
* **승률 하락은 정상**: 나쁜 진입을 차단하면 진입 횟수와 승률은 다소 하락할 수 있으나, 손익비 상승으로 인해 전체 수익금은 증가합니다.
* **시장 환경 영향**: 강세장에서는 Trailing Stop이, 약세장에서는 손절 엄격화가 수익률 방어의 핵심 역할을 합니다.

---

## Release 22: Trading Agent 가이드 강화 및 모델 업그레이드 (2025.12.03)

**PRISM-INSIGHT v1.12.1** (PR #106)

### 🎯 변경 목적
* **보고서 활용도 극대화**: Trading Agent가 분석 보고서의 각 섹션을 명확히 인지하고 데이터를 누락 없이 읽도록 가이드 강화
* **분석 정교화**: '재료 유효성(지속성)' 체크 항목을 추가하여 추세추종 매매의 신뢰도 향상
* **의사결정 성능 향상**: 프롬프트 복잡도 증가에 대응하기 위해 모델을 `gpt-5.1`로 업그레이드하고 추론 강도를 `high`로 상향
* **가독성 개선**: 분석 프로세스와 진입 가이드를 분리하여 에이전트의 논리적 흐름 개선

### ✨ 주요 변경사항
**1. 📖 보고서 섹션별 확인 가이드 도입 ⭐**
* 에이전트가 보고서의 어느 섹션에서 어떤 데이터를 추출해야 하는지 명시한 테이블 가이드를 추가했습니다.
* 1-1(기술적 분석), 2-1(재무), 3(뉴스) 등 섹션별 핵심 확인 포인트를 정의했습니다.

**2. ✅ 체크리스트 구조 개선 및 섹션 명시**
* 각 체크 항목(재무 건전성, 성장 동력 등)이 보고서의 어느 섹션을 참고해야 하는지 구체적으로 연결했습니다.
* "종합 판단" 지침을 추가하여 단편적인 지표가 아닌 포괄적인 분석을 유도합니다.

**3. ⭐ 재료 유효성(지속성) 체크 항목 신규 추가**
* 현재 주가 상승의 원인이 되는 뉴스/재료가 일회성인지 지속 가능한 모멘텀인지 판단하는 로직을 추가했습니다.
* 재료 소멸 시의 리스크를 사전에 평가하도록 설계했습니다.

**4. 📁 분석 프로세스 및 가이드 구조 리팩토링**
* '분석 프로세스'와 '진입 결정 가이드'를 별도 섹션으로 분리하여 에이전트의 가독성과 처리 효율을 높였습니다.

**5. 🤖 모델 및 추론 설정 업그레이드**
* 기본 모델: `gpt-5` -> **`gpt-5.1`**
* 추론 강도(`reasoning_effort`): `medium` -> **`high`**

### 📊 개선 효과
* **분석 정확도**: 보고서 데이터 기반의 근거 있는 매매 판단 강화
* **리스크 관리**: 재료의 유효 기간을 고려한 더욱 신중한 진입 결정
* **성능 최적화**: 고성능 모델과 높은 추론 설정을 통한 복잡한 시나리오 처리 능력 확보

### 🔧 기술 세부사항
* **변경된 파일**: 
    * `cores/agents/trading_agents.py`: 에이전트 인스트럭션 고도화
    * `docs/analysis/mcp_agent_config_ko.md`: 모델 설정 가이드 업데이트
    * `RELEASE_NOTES_ko.md`: 릴리즈 노트 추가

---

## Release 21: 라이센스 듀얼 체계 전환 및 GCP Pub/Sub 통합 (2025.11.30)

**PRISM-INSIGHT v1.12.0**

### 🎯 변경 목적
* **확장성 제약 해결**: Redis Pub/Sub의 다중 구독자 시나리오 및 메시지 보존 한계 극복을 위해 GCP Pub/Sub 도입
* **서비스 연속성 확보**: Upstash 무료 티어의 자동 비활성화(30일 무활동 시)를 방지하는 헬스체크 자동화
* **라이센스 명확화 및 지속가능성**: MIT 라이센스의 SaaS 상용화 시 소스 공개 의무 불분명 문제를 해결하고, 인프라 운영 비용($174/월) 감당을 위한 듀얼 라이센스 체계 확립

### ✨ 주요 변경사항
**1. 🔐 라이센스 듀얼 체계 전환 ⭐⭐⭐**
* **AGPL 3.0 (개인/오픈소스)**: 개인 학습, 학술 연구, 오픈소스 프로젝트용. 수정 시 소스 공개 및 네트워크 사용 시 배포로 간주하는 강력한 카피레프트 적용.
* **Commercial License (SaaS/기업용)**: 소스 공개 의무 없이 상업적 이용 가능. 전용 기술 지원 및 우선 기능 개발 혜택 제공.
* **관련 문서**: `LICENSE`, `LICENSE-ko.md`, `LICENSE-COMMERCIAL.md`, `LICENSE-COMMERCIAL-ko.md` 추가 및 `README.md` 업데이트.

**2. 📡 GCP Pub/Sub 실시간 매매 신호 시스템 ⭐⭐⭐**
* **엔터프라이즈급 메시징**: Redis와 GCP Pub/Sub을 병행하는 듀얼 메시징 아키텍처 구축.
* **신뢰성 보장**: 구독자 오프라인 시에도 최대 7일간 메시지 보존, At-least-once 전달 및 자동 재시도 메커니즘 확보.
* **확장성**: 무제한 구독자 확장 및 글로벌 분산 처리 가능.

**3. 💓 Redis 헬스체크 자동화 ⭐⭐**
* **비활성화 방지**: 주기적인 하트비트 발행을 통해 Upstash 무료 티어의 자동 아카이빙 방지.
* **자동화**: GitHub Actions를 활용하여 매일 정해진 시간에 자동 실행되도록 구성.

**4. 📺 유튜브 통합 개선**
* 전인구 경제연구소 채널 분석 대시보드 및 메시지 포맷 최적화.

### 📊 개선 효과
* **라이센스 보호**: SaaS 기업의 무단 수익화 방지 및 프로젝트 운영 재원 확보.
* **메시지 손실 제로**: GCP 인프라를 통한 99.95% SLA 보장 및 안정적인 신호 전달.
* **운영 비용 절감**: 헬스체크 자동화로 Upstash 무료 티어를 안정적으로 지속 사용 가능.

### 🔧 기술 세부사항
* **신규 파일**:
    * `messaging/gcp_pubsub_signal_publisher.py`: Publisher 구현
    * `examples/messaging/gcp_pubsub_subscriber_example.py`: Subscriber 예제
    * `messaging/redis_health_check.py`: 헬스체크 로직
    * `tests/test_gcp_pubsub_signal.py`: 통합 테스트 코드
* **환경 설정**: `.env`에 GCP 관련 설정(`GCP_PROJECT_ID`, `GCP_PUBSUB_TOPIC_ID` 등) 추가 필요.
* **의존성**: `google-cloud-pubsub==2.26.1` 추가.

### 💡 실제 사용 예시 (GCP Pub/Sub 신호 발행)
```python
from messaging.gcp_pubsub_signal_publisher import SignalPublisher

async with SignalPublisher() as publisher:
    # 매수 신호 발행
    await publisher.publish_buy_signal(
        ticker="005930",
        company_name="삼성전자",
        price=82000,
        scenario={
            "target_price": 90000,
            "stop_loss": 78000,
            "confidence": 8
        }
    )
```

---

## Release 20: Firecrawl MCP 서버 정상화 및 섹터 주도주 분석 도입 (2025.11.25)

**PRISM-INSIGHT v1.11.2**

### 🎯 변경 목적
* **기존 문제점 해결**:
    * **Firecrawl 도구 미작동**: 프롬프트에 명시되어 있었으나 실제로는 연동되지 않아 네이버 금융 뉴스를 수집하지 못하던 문제 해결
    * **Perplexity 할루시네이션**: 2-3년 전 오래된 뉴스를 최신 정보처럼 제공하여 분석 신뢰도가 저하되던 문제 방지
    * **섹터 맥락 부재**: 개별 종목 뉴스만으로 주가 변동이 섹터 전체 현상인지 개별 현상인지 판단하기 어려웠던 점 개선
* **목표**: Firecrawl MCP 서버를 정식 통합하고, Perplexity 할루시네이션 방지 프롬프트 체계 및 섹터 주도주 분석 프로세스를 구축하여 분석의 정확도와 신뢰도를 대폭 향상시킵니다.

### ✨ 주요 변경사항
**1. Firecrawl MCP 서버 정상화 ⭐**
* 실제 작동하는 Firecrawl 도구를 통해 네이버 금융 뉴스를 직접 수집합니다.
* `maxAge: 7200000` (2시간 캐시) 설정을 통해 성능을 500% 향상시켰습니다.
* 한국 증시에 가장 신뢰할 수 있는 정보원을 확보했습니다.

**2. Perplexity 할루시네이션 방지 체계 구축 ⭐**
* **기준일 필수 명시**: 모든 Perplexity 쿼리에 `{reference_date}`를 강제 포함하여 최신 정보를 요청합니다.
* **날짜 검증 프로세스**: 답변 내 뉴스 날짜를 확인하여 기준일과 동떨어진 정보는 분석에서 제외합니다.
* **Firecrawl 우선 전략**: 가장 신뢰도 높은 네이버 금융 뉴스를 우선 수집하고, Perplexity는 보조적으로 활용합니다.

**3. 섹터 주도주 분석 프로세스 추가 (신규)**
* 개별 종목의 상승이 섹터 전체의 흐름인지, 개별적인 일시적 현상인지 판단하는 로직을 도입했습니다.
* **프로세스**: 개별 뉴스 수집 → 섹터 주도주 파악 → 주도주 뉴스 수집 → 섹터 동향 분석 → 최종 신뢰도 평가.

**4. 도구 역할 명확화**
* `firecrawl_scrape`: 네이버 금융 뉴스 수집 (개별 종목 + 주도주) - **최고 신뢰도**
* `perplexity_ask`: 주도주 파악, 섹터 동향 분석 (날짜 검증 필수) - **보조 도구**

### 📊 개선 효과
* **Before (v1.11.1)**: Firecrawl 미작동으로 뉴스 수집 실패, 오래된 뉴스를 최신으로 오인하는 할루시네이션 발생, 섹터 맥락 부재로 신뢰도 판단 불가.
* **After (v1.11.2)**: 네이버 금융 뉴스 직접 수집, 최신 정보 기반 분석, 섹터 주도주 분석을 통한 주가 변동 신뢰도 평가 가능, 캐시 적용으로 성능 대폭 향상.

### 🔧 기술 세부사항
* **변경된 파일**: `cores/agents/news_strategy_agents.py`
* **핵심 개선사항**:
    * Firecrawl 통합: `maxAge: 7200000`, `formats: ["markdown"]`, `onlyMainContent: true`
    * Perplexity 날짜 검증: 쿼리에 날짜 필수 포함 및 답변 날짜 검증 로직 추가
    * 섹터 분석: 주도주 파악 및 동향 분석 단계 필수화

### 💡 실제 사용 예시 (엔씨소프트 분석)
1. **개별 뉴스**: Firecrawl로 네이버 금융 직접 접속하여 최신 뉴스 수집.
2. **섹터 분석**: Perplexity로 게임 섹터 주도주(크래프톤, 넷마블 등) 파악 및 동향 질문.
3. **주도주 뉴스**: Firecrawl로 주도주들의 최신 호재 확인.
4. **결론**: 주도주와 섹터 전체가 상승세임을 확인하여 엔씨소프트 상승의 신뢰도가 높음을 판단.

---

## Release 19: Redis Streams 기반 실시간 트레이딩 시그널 Pub/Sub 시스템 추가 (2025.11.22)

**PRISM-INSIGHT v1.10.0** (PR #87)

### 🎯 변경 목적
PRISM-INSIGHT 본체에서 발생하는 매수/매도 시그널을 외부 시스템에서 구독하여 다양하게 활용할 수 있도록 Redis Streams 기반 Pub/Sub 시스템을 도입했습니다. 이를 통해 동일 시그널을 한국투자증권의 다른 계좌에서 동시 매매하거나, 여러 증권사 계좌에 분산 매매, 시그널 기반 커스텀 매매 로직 구현, 시그널 로깅 및 분석 시스템 구축, 텔레그램/슬랙 등 알림 시스템 연동 등 다양한 활용이 가능해집니다.

### ✨ 주요 변경사항
**1. Upstash Redis Streams 시그널 퍼블리셔**
* 매수/매도 실행 시 자동으로 Redis Streams에 시그널을 발행하는 로직이 추가되었습니다.
* 발행되는 시그널은 `type`, `ticker`, `company_name`, `price`, `target_price`, `stop_loss`, `sector`, `rationale` 등 상세한 매매 정보를 포함합니다.

**2. 구독자 예제 스크립트 제공**
* `examples/messaging/redis_subscriber_example.py`에서 시그널을 구독하고 자동매매와 연동하는 예제를 제공합니다.
* `--dry-run` 옵션을 통해 매매 없이 시그널만 확인하는 시뮬레이션 모드를 지원합니다.

**3. Graceful Degradation (점진적 성능 저하)**
* Redis가 설정되지 않으면 시그널 발행을 자동으로 스킵합니다. Upstash Redis 미연동(토큰 미발급) 시 기존 로직에 영향 없이 정상 동작합니다. 기존 사용자는 아무런 추가 설정 없이 그대로 사용할 수 있습니다.

### 🚀 사용 방법
**Step 1: Upstash Redis 생성**
1. Upstash Console에 가입합니다.
2. 새 Redis 데이터베이스를 생성합니다.
3. REST API 탭에서 `UPSTASH_REDIS_REST_URL`과 `UPSTASH_REDIS_REST_TOKEN`을 복사합니다.

**Step 2: 환경변수 설정**
`.env` 파일에 다음을 추가합니다:
```bash
# Redis Streams (Optional - for trading signal pub/sub)
UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_token_here
```

**Step 3: 구독자 실행**
```bash
# 새 메시지만 수신
python examples/messaging/redis_subscriber_example.py
# 처음부터 모든 메시지 수신
python examples/messaging/redis_subscriber_example.py --from-beginning
# 시뮬레이션 모드
python examples/messaging/redis_subscriber_example.py --dry-run
```

---

## Release 18: 매수 로직 정교화 및 자동매매 안정성 강화 (2025.11.18)

**PRISM-INSIGHT v1.9.5** (PR #82, #83, ISSUE #79)

### 🎯 변경 목적
매수 종목 선정 시 확실한 모멘텀(박스권 돌파, 추세 전환, 의미 있는 거래량)이 확인되는 종목 위주로 선별하도록 로직을 강화합니다. 또한, 수능일과 같이 시장 운영 시간이 변동되는 특수 상황에서 예약매매 실패 시 시장가로 재시도하는 보완 로직을 추가하여 자동매매의 실행 신뢰도를 높입니다.

### ⭐ 주요 개선 사항
**1. 매수 에이전트 프롬프트 고도화**
* **모멘텀 필터링 강화**: 단순 상승이 아닌 확실한 박스권 상향 돌파, 기술적 추세 전환, 직전 고점을 뚫는 의미 있는 거래량 동반 여부를 더 엄격하게 판단하도록 프롬프트를 업데이트했습니다.
* **진입 품질 향상**: 속임수 반등을 배제하고 추세의 시작점에 있는 종목 선별력을 높였습니다.

**2. 자동매매 예약매매 실패 보완 로직**
* **시장가 재시도**: 시장 시간 변동 등으로 인해 예약매매(장외)가 실패할 경우, 시스템이 이를 감지하고 시장가 매매로 한 번 더 시도를 수행하여 매매 기회 상실을 방지합니다.

**3. 문서 최신화**
* **README 업데이트**: 프로젝트의 최신 성과 및 변경된 설치/운영 가이드를 반영했습니다.

### 📋 상세 변경 사항
* **`cores/agents/trading_agents.py`**: 매수 에이전트(`trading_scenario_agent`)의 모멘텀 판단 지침 강화
* **`trading/domestic_stock_trading.py`**: 예약매매 실패 시 예외 처리 및 시장가 재주문 로직 구현
* **`README.md` & `README_ko.md`**: 최신 프로젝트 정보 및 가이드 업데이트

### 🎬 기대 효과
* **매매 승률 개선**: 확실한 기술적 근거가 있는 종목에 집중하여 진입 정확도 향상
* **운영 안정성**: 특수 공휴일이나 시장 시간 변경 시에도 중단 없는 자동매매 수행
* **정보 전달력**: 최신화된 문서를 통해 신규 사용자의 원활한 온보딩 지원

---

## Release 17: PDF 변환 엔진 마이그레이션 및 시스템 안정성 강화 (2025.11.13)

**PRISM-INSIGHT v1.9.2** (PR #73, #74, #75)

### 🎯 변경 목적
2023년 이후 유지보수가 중단된 `wkhtmltopdf`를 대체하여 최신 웹 표준을 지원하는 `Playwright (Chromium)` 기반 엔진으로 전환합니다. 이를 통해 PDF 생성의 안정성을 확보하고, `asyncio` 환경에서의 호환성 문제 해결 및 설치 자동화를 구현하여 유지보수성을 대폭 개선했습니다.

### ⭐ 주요 개선 사항
**1. PDF 변환 엔진 교체: wkhtmltopdf → Playwright**
* **Chromium 기반 렌더링**: 최신 HTML/CSS 표준을 완벽하게 지원하여 리포트 디자인의 정확도를 높였습니다.
* **자동 설치 지원**: 첫 실행 시 Chromium 브라우저를 자동으로 다운로드하며, macOS/Linux/Windows(WSL2) 등 모든 플랫폼에서 동일하게 작동합니다.

**2. asyncio 호환성 및 성능 최적화**
* **비동기 루프 충돌 해결**: `ThreadPoolExecutor`를 사용하여 `asyncio` 루프 내에서도 Playwright Sync API가 안전하게 동작하도록 리팩토링했습니다.
* **리소스 최적화**: 브라우저 실행 옵션(`--no-sandbox`, `--disable-dev-shm-usage`)을 최적화하고 PDF 압축 기능을 추가하여 파일 크기를 절감했습니다.

**3. Docker 및 문서화 강화**
* **Dockerfile 최적화**: 불필요한 `wkhtmltopdf` 패키지를 제거하고 Playwright 의존성을 추가했습니다.
* **설치 가이드 제공**: `utils/PLAYWRIGHT_SETUP.md` 및 자동 설치 스크립트(`setup_playwright.sh`)를 추가하여 초기 환경 구축 편의성을 높였습니다.

### 📋 상세 변경 사항
* **`pdf_converter.py`**: Playwright 기반 변환 함수 구현 및 PDF 압축 로직 추가
* **`stock_analysis_orchestrator.py`**: PDF 변환 메서드를 `playwright`로 기본값 변경
* **`Dockerfile` & `docker-compose.yml`**: Playwright 설치 명령 추가 및 로컬 설정 파일 마운트 구조 개선
* **`requirements.txt`**: `playwright>=1.40.0` 의존성 추가
* **`README.md` & `README_ko.md`**: PDF 변환 엔진 변경에 따른 설치 가이드 업데이트

### 📦 설치 및 업그레이드
**로컬 환경**
```bash
pip install -r requirements.txt
python3 -m playwright install chromium
# 또는 자동 설치 스크립트 사용: cd utils && ./setup_playwright.sh
```
**Docker 환경**
```bash
docker-compose build --no-cache
docker-compose up -d
```

### 🎬 기대 효과
* **장기 유지보수성**: 활발히 개발 중인 Playwright 채택으로 시스템 수명 연장
* **안정성**: `asyncio` 환경에서도 데드락 없이 안정적인 리포트 생성 보장
* **편의성**: 브라우저 자동 다운로드로 사용자 설정 단계 최소화

---

## Release 16: 글로벌 확장 및 다국어 브로드캐스팅 시스템 도입 (2025.11.12)

**PRISM-INSIGHT v1.9.0**

### 🎯 변경 목적
PRISM-INSIGHT를 글로벌 사용자를 위한 다국어 지원 시스템으로 확장합니다. 한국 주식시장 분석을 전 세계 투자자들이 자신의 언어로 받아볼 수 있도록 언어 선택 및 다국어 브로드캐스팅 기능을 추가하여 해외 투자자 접근성을 대폭 향상시켰습니다.

### ⭐ 주요 개선 사항
**1. 메인 채널 언어 선택 및 다국어 브로드캐스팅**
* **언어 선택 (`--language`)**: 메인 채널의 리포트 언어를 한국어(ko), 영어(en), 일본어(ja), 중국어(zh) 등으로 자유롭게 선택할 수 있습니다.
* **브로드캐스팅 (`--broadcast-languages`)**: 메인 채널과 별도로 여러 언어 채널에 동시 전송이 가능합니다. (예: `TELEGRAM_CHANNEL_ID_EN` 등 설정 필요)
* **Translation Specialist 추가**: GPT-5-nano 기반의 전문 번역 에이전트를 도입하여 정보의 정확도를 높였습니다. (에이전트 수 12개 → 13개)

**2. 지능형 번역 파이프라인 및 차트 국제화**
* **이미지 보존 번역**: Base64 이미지 차트를 보존하는 placeholder 패턴을 구현하여 번역 후에도 리포트 내 이미지가 완벽하게 복원됩니다.
* **차트 레이블 영문화**: Trading Volume Chart의 투자자 유형 레이블을 영어로 변환하고 한글 범례 깨짐 문제를 해결하여 글로벌 가독성을 높였습니다.

**3. 시스템 안정성 및 아키텍처 개선**
* **비동기 브로드캐스팅**: 메인 파이프라인의 블로킹을 방지하기 위해 번역 및 전송 과정을 비동기로 처리합니다.
* **텔레그램 API 강화**: HTTPXRequest 기반 30초 타임아웃 설정 및 Exponential backoff 재시도 로직을 적용하여 전송 신뢰도를 개선했습니다.

### 📋 상세 변경 사항
* **`stock_analysis_orchestrator.py`**: 언어 파라미터 처리, 번역 파이프라인 및 이미지 추출/복원 로직 구현
* **`telegram_bot_agent.py`**: 타임아웃 설정 및 재시도(Retry) 로직 추가
* **`cores/stock_chart.py`**: 차트 레이블 영문화 매핑 추가
* **`cores/agents/telegram_translator_agent.py` (신규)**: 전문 번역 에이전트 구현
* **`trading/portfolio_telegram_reporter.py`**: 포트폴리오 리포트 비동기 브로드캐스팅 구현
* **`README.md` & `README_ko.md`**: 시즌2 성과 반영, 다국어 사용 예제 추가 및 스폰서 정보 업데이트

### 🎬 기대 효과
* **글로벌 사용자 확대**: 언어 장벽을 제거하여 전 세계 투자자들에게 한국 시장 분석 정보 제공 가능
* **전송 신뢰도 향상**: 네트워크 불안정 상황에서도 안정적인 메시지 전송 보장
* **정보 정확도**: 전문 번역 에이전트를 통한 고품질 리포트 제공

---

## Release 15: 텔레그램 선택적 사용 기능 추가 및 성능 최적화 (2025.11.02)

**PRISM-INSIGHT v1.8.0** (PR #65, ISSUE #64)

### 🎯 변경 목적
텔레그램 설정 없이도 핵심 분석 기능을 테스트할 수 있도록 로컬 개발 환경의 진입 장벽을 제거합니다. 불필요한 메시지 생성 및 전송 과정을 스킵하여 성능을 최적화하고, 사용자의 환경에 따른 유연한 실행 옵션을 제공합니다.

### ⭐ 주요 개선 사항
**1. `--no-telegram` CLI 옵션 추가**
* **유연한 실행**: 텔레그램 API 키나 채널 ID 설정 없이도 `급등주 포착 → 보고서 생성 → PDF 변환 → 트래킹 시스템`의 핵심 파이프라인을 정상적으로 실행할 수 있습니다.
* **비용 절감**: 텔레그램용 AI 요약 메시지 생성 단계를 스킵하여 API 호출 비용을 절감합니다.

**2. `TelegramConfig` 클래스 도입 (SOLID 원칙 준수)**
* **설정 중앙화**: 텔레그램 관련 설정을 하나의 클래스에서 관리하며, 의존성 주입 패턴을 적용하여 코드의 유지보수성을 높였습니다.
* **자동 환경변수 로드**: `.env` 파일을 자동으로 감지하고 로드하며, 설정 누락 시 명확한 가이드 메시지를 제공합니다.

**3. 파이프라인 최적화**
* **속도 개선**: 텔레그램 비활성화 시 메시지 생성/전송 및 관련 파일 I/O가 스킵되어 전체 실행 시간이 **30~50% 단축**됩니다.

### 📋 상세 변경 사항
* **`telegram_config.py` (신규)**: `TelegramConfig` 클래스 구현 및 설정 검증 로직 추가
* **`TELEGRAM_USAGE.md` (신규)**: 텔레그램 옵션 상세 가이드 및 문제 해결 문서 추가
* **`stock_analysis_orchestrator.py`**: `--no-telegram` 옵션 처리 및 파이프라인 조건부 실행 로직 반영
* **`stock_tracking_agent.py`**: 텔레그램 전송 실패나 미사용 시에도 트래킹 배치가 중단되지 않도록 개선
* **`README.md`**: 기본 실행 섹션 및 필수 설정 파일 안내 업데이트

### 🎬 기대 효과
* **개발 효율성**: 로컬 환경에서 텔레그램 설정 없이 즉시 핵심 로직 테스트 가능
* **성능 향상**: 불필요한 네트워크 호출 및 AI 생성 비용 제거
* **사용자 경험**: 에러 메시지 개선 및 명확한 사용 가이드 제공을 통한 진입 장벽 완화

---

## Release 14: 매도 전략 고도화 및 시장 환경 기반 차별화 전략 도입 (2025.11.01)

**PRISM-INSIGHT v1.7.7** (PR #63)

### 🎯 변경 목적
대한전선 사례 분석 결과, 목표가 도달 후에도 강세 추세 지속 시 조기 매도로 추가 수익 기회 상실 확인. 시장 환경에 따른 유연한 매도 전략을 통해 강세장에서는 수익을 극대화하고, 약세장에서는 방어적 익절로 수익률을 개선합니다.

### ⭐ 주요 개선 사항
**1. 시장 환경 기반 매도 전략 차별화**
* **시장 환경 파악 (0단계)**: KOSPI/KOSDAQ 20일 이동평균선, 수급(외인/기관), 거래량 등을 종합하여 강세장과 약세장/횡보장을 구분합니다.
* **강세장 모드 (추세 우선)**: 목표가는 최소 기준일뿐, 추세가 살아있으면 계속 보유합니다. Trailing Stop 범위를 고점 대비 **-8~10%**로 확대하여 노이즈를 견디고 수익을 극대화합니다.
* **약세장/횡보장 모드 (수익 확보)**: 목표가 도달 시 즉시 매도를 고려하며, Trailing Stop을 고점 대비 **-3~5%**로 타이트하게 유지하여 방어적으로 대응합니다.

**2. 매수 에이전트 market_condition 필드 명시화**
* **용어 통일**: 매수 에이전트의 JSON 응답 필드 설명을 "시장 추세 분석 (상승추세/하락추세/횡보)"으로 개선하여 매도 에이전트와의 판단 일관성을 확보했습니다.

### 📋 상세 변경 사항
* **`stock_tracking_enhanced_agent.py` & `cores/agents/trading_agents.py`**: 
    - 매도 에이전트 instruction 전면 개편
    - "0단계: 시장 환경 파악" 섹션 추가
    - 수익 실현 섹션을 시장 환경별(강세/약세) 모드로 분리
    - Trailing Stop 기준 차별화 (-8~10% vs -3~5%)
* **`stock_tracking_agent.py`**: `market_condition` 필드 설명 명시화 및 에이전트 간 용어 통일

### 🎬 기대 효과
* **수익률 제고**: 강세장에서의 조기 매도를 방지하여 추세 상승분을 최대한 확보
* **리스크 관리**: 약세장에서의 빠른 익절을 통해 변동성 장세에서의 수익 보존
* **판단 일관성**: 매수부터 매도까지 시장 상황에 대한 통일된 분류 체계 적용

---

## Release 13: 동전주 필터링 강화 및 종목 선별 정확도 향상 (2025.10.30)

**PRISM-INSIGHT v1.7.6** (PR #62)

### 🎯 변경 목적
저시가총액 동전주 제외를 통한 투자 안정성 향상 및 유동성이 확보된 신뢰성 있는 종목 위주의 선별 강화

### ⭐ 주요 개선 사항
**1. 동전주 필터링 로직 추가**
* **적용 범위**: 모든 오전/오후 트리거 알고리즘(6종)에 일괄 적용
* **기준 상향**: 시가총액 필터 기준을 기존 100억원에서 **500억원 이상**으로 상향하여 변동성이 큰 소형주 배제
* **데이터 연동**: 모든 트리거 함수에 시가총액 데이터(`cap_df`) 파라미터를 추가하고 필터링 로직을 적용하여 정밀한 스크리닝 수행

**2. 종목 평가 기준 명시화**
* **저가주 판단 기준**: 주가 1,000원 이하의 동전주를 종목 평가 6점 이하(매수 부적합) 항목에 명시적으로 추가
* **AI 판단력 강화**: AI 에이전트가 저가 종목에 대한 명확한 판단 기준을 확보하여 의사결정 신뢰도 향상

### 📋 상세 변경 사항
* **`trigger_batch.py`**: 
    - 6개 트리거 함수 전체에 시가총액 데이터 병합 로직 추가
    - 필터링 적용 후 남은 종목 수에 대한 디버그 로깅 추가
* **`stock_tracking_agent.py`**: 종목 평가 기준 가이드라인에 "1,000원 이하 동전주 제외" 원칙 명시

### 🎬 기대 효과
* **리스크 관리**: 급격한 변동성 및 시세 조작 가능성이 높은 저시가총액 종목 자동 필터링
* **유동성 확보**: 충분한 시가총액을 가진 중대형주 위주의 포트폴리오 구성 지원
* **분석 효율화**: 부적합 종목을 1차 스크리닝하여 AI 분석 리소스 낭비 방지

---

## Release 12: 오전장 대응 강화 및 대시보드 가독성 개선 (2025.10.29)

**PRISM-INSIGHT v1.7.5** (PR #60, #61)

### 🎯 변경 목적
오전장 매매 정확성 향상 및 대시보드 사용자 경험(UX) 개선

### ⭐ 주요 개선 사항
**1. 매수/매도 에이전트 프롬프트 수정 (오전장 대응 정확도 향상)**
* **시간 기반 분석 로직 도입**: `time-get_current_time` 도구를 사용하여 현재 시간을 확인하고, 장중 데이터와 장 마감 후 데이터를 차별화하여 분석하도록 개선했습니다.
* **장중(09:00~15:20) 분석 원칙**: 당일 거래량/캔들은 미완성 데이터로 간주하여 "거래량 부족" 등의 확정적 판단을 금지하고, 전일 확정 데이터 중심으로 분석하도록 지침을 강화했습니다.
* **장 마감 후(15:30 이후) 분석 원칙**: 당일의 모든 기술적 지표를 신뢰할 수 있는 데이터로 활용하여 적극적인 분석을 수행합니다.

**2. 대시보드 가독성 및 정보량 확대**
* **손절가 변경 이력 시각화**: 'AI 보유 분석' 탭에서 포트폴리오 조정(Trailing Stop 등)으로 인한 손절가 변경 내역이 명확하게 표시되도록 수정했습니다.
* **매매 시나리오 추가**: '거래내역' 탭에서 각 종목의 진입 당시 AI가 작성했던 상세 매매 시나리오를 확인할 수 있는 기능을 추가했습니다.

**3. 데이터 관리 정책 최적화**
* **관망종목 30일 보유 정책**: `watchlist_history` 데이터의 보관 기간을 30일로 설정하여, 불필요한 과거 데이터 누적으로 인한 대시보드 스크롤 부하를 방지하고 시스템 성능을 최적화했습니다.

### 📋 상세 변경 사항
* **`cores/agents/trading_agents.py`**: 장중/장후 데이터 신뢰도 판단 기준 프롬프트 추가
* **`examples/dashboard/`**: 손절가 변경 로직 반영 및 거래내역 상세 모달 내 시나리오 섹션 추가
* **`stock_tracking_enhanced_agent.py`**: 관망종목 데이터 자동 정리(Cleanup) 로직 강화

### 🎬 기대 효과
* **판단 오류 감소**: 데이터가 완성되지 않은 오전장에 발생할 수 있는 AI의 성급한 판단 방지
* **복기 기능 강화**: 과거 거래의 시나리오를 대시보드에서 즉시 확인하여 전략 개선에 활용
* **쾌적한 UI**: 데이터 최신성 유지 및 대시보드 로딩 속도 개선

---

## Release 11: 실시간 성과 대시보드 프론트엔드 도입 (2025.10.29)

**PRISM-INSIGHT v1.7.4** (PR #57, #58, #59)
* **공식 대시보드**: [https://analysis.stocksimulation.kr](https://analysis.stocksimulation.kr)

### 🎯 변경 목적
PRISM-INSIGHT의 매매 시뮬레이션 및 실전투자 성과를 투명하게 실시간으로 모니터링할 수 있는 웹 대시보드를 제공합니다. 사용자에게 직관적인 데이터 시각화와 AI 의사결정 분석 인터페이스를 제공하여 프로젝트의 신뢰성을 강화하고 커뮤니티 유입을 촉진합니다.

### ⭐ 주요 개선 사항
**1. Next.js 기반 실시간 대시보드 추가**
* **기술 스택**: Next.js 16 + React 19 + TypeScript + Tailwind CSS
* **주요 페이지**:
  * **대시보드**: 핵심 지표(수익률, 승률), 포트폴리오 현황, 시장 지수 차트
  * **AI 보유 분석**: AI 에이전트의 종목별 상세 의사결정 근거 분석
  * **거래 내역**: 과거 매매 기록 및 상세 수익률 통계
  * **관심 종목**: 현재 AI가 모니터링 중인 잠재적 진입 후보 리스트

**2. 시각화 및 인터랙티브 컴포넌트**
* **핵심 지표 카드**: 누적 수익률, 승률, 보유 종목 수 등 주요 KPI 시각화
* **성과 차트**: Recharts를 활용한 KOSPI/KOSDAQ 지수 대비 성과 비교
* **종목 상세 모달**: 클릭 시 해당 종목의 AI 분석 리포트 요약 및 지표 팝업

**3. 프로젝트 브랜딩 및 소셜 통합**
* **Header**: "Open Source" 뱃지, GitHub/Telegram 바로가기, 테마 전환(다크/라이트) 지원
* **Footer**: 프로젝트 소개, 사용된 AI 모델 정보(GPT-4.1, GPT-5, Claude 4.5), 면책 조항 명시

**4. 데이터 자동 갱신 시스템**
* **배치 스크립트**: `generate_dashboard_json.py`를 통한 주기적 데이터 추출
* **자동화**: Crontab을 활용하여 매일 2회(11:05, 17:05) 최신 시장 데이터 반영

### 📁 새로운 파일 구조 (`examples/dashboard/`)
* `app/`: Next.js App Router 기반 페이지 및 레이아웃
* `components/`: 헤더, 푸터, 차트, 테이블 등 재사용 가능한 UI 컴포넌트
* `types/` & `lib/`: TypeScript 타입 정의 및 유틸리티 함수
* `DASHBOARD_README.md`: 대시보드 전용 설치 및 설정 가이드

### 🎨 디자인 특징
* **반응형 UI**: 모바일, 태블릿, 데스크톱 환경에 최적화된 레이아웃
* **브랜드 일관성**: Primary-Purple-Blue 그라데이션을 활용한 세련된 디자인
* **접근성**: ARIA 속성 및 키보드 네비게이션 지원

### 📊 데이터 구조 (`dashboard_data.json`)
대시보드는 다음 구조화된 데이터를 로드하여 표시합니다:
* `summary`: 전체 요약 통계
* `holdings` & `real_portfolio`: 시뮬레이션 및 실전 계좌 현황
* `trading_history`: 과거 거래 이력
* `watchlist`: AI 관심 종목
* `market_condition`: 시장 지수 데이터

### 🚀 배포 및 설정
**설치 및 실행**
```bash
cd examples/dashboard
npm install react-is --legacy-peer-deps
npm run build
pm2 start npm --name "dashboard" -- start
```

**Crontab 데이터 갱신 설정**
```bash
# 매일 오전 11:05, 오후 17:05 데이터 갱신
05 11 * * * cd /project-root/examples && python generate_dashboard_json.py >> /project-root/logs/generate_dashboard_json.log 2>&1
05 17 * * * cd /project-root/examples && python generate_dashboard_json.py >> /project-root/logs/generate_dashboard_json.log 2>&1
```

---

## Release 10: MCP 서버 프로세스 누적 방지 및 싱글톤 패턴 적용 (2025.10.25)

**PRISM-INSIGHT v1.7.3** (PR #56)

### 🎯 변경 목적
매 요청마다 새로운 `MCPApp` 인스턴스가 생성되어 `kospi_kosdaq_stock_server` 프로세스가 누적되는 문제를 해결합니다. 이를 통해 메모리 및 CPU 리소스 고갈을 방지하고 시스템의 전반적인 안정성과 성능을 향상시킵니다.

### ⭐ 주요 개선 사항
**1. 전역 MCPApp 싱글톤 패턴 도입**
* `get_or_create_global_mcp_app()` 함수를 통해 단일 인스턴스를 관리합니다.
* 서버 프로세스를 한 번만 생성하고 재사용함으로써 리소스 효율성을 획기적으로 개선했습니다.

**2. 자동 리소스 정리 메커니즘 강화**
* `cleanup_global_mcp_app()` 함수로 명시적인 리소스 정리를 지원합니다.
* `atexit` 핸들러를 등록하여 프로그램 종료 시 프로세스가 자동으로 정리되도록 보장합니다.
* 오류 발생 시 시스템을 복구할 수 있는 자동 재시작 기능(`reset_global_mcp_app()`)을 추가했습니다.

**3. 봇 생명주기 관리 개선**
* 봇 시작 시 전역 `MCPApp`을 초기화하고, 종료 시 정리를 수행합니다.
* Agent 연결 지속성 설정(`connection_persistence=True`)을 통해 불필요한 재연결 비용을 줄였습니다.

**4. AI 프롬프트 최적화 (원상복구)**
* v1.7.2에서 현재 날짜 강조를 위해 지나치게 길어졌던 프롬프트를 기존의 효율적인 형태로 원상복구했습니다. (기존 프롬프트로도 충분한 정확도 확인)

### 🐛 버그 수정
* 매 요청마다 새로운 MCP 서버 프로세스가 생성되어 서버 리소스가 고갈되던 치명적인 버그를 수정했습니다.
* 프로세스 미정리로 인해 서버가 응답하지 않던 현상을 해결했습니다.

### 🔄 호환성
* ✅ **기존 기능 완전 호환**: 내부적인 인스턴스 관리 방식만 변경되었습니다.
* ✅ **리소스 효율성**: 동일 사양 서버에서 더 많은 요청을 안정적으로 처리할 수 있습니다.

---

## Release 9: 보유 종목 보유 사유 추적 시스템 추가 (2025.10.23)

**PRISM-INSIGHT v1.7.1** (PR #54)

### 🎯 변경 목적
보유 종목에 대한 보유 판단 데이터를 체계적으로 저장하여 대시보드에서 최신 AI 분석 내용을 표시할 수 있도록 합니다. 매도 시 자동으로 보유 사유 데이터를 삭제하여 현재 보유 중인 종목의 최신 분석 결과만 효율적으로 관리합니다.

### ⭐ 주요 개선 사항
**1. Holding Decisions 테이블 추가**
* 보유 종목의 AI 매도 판단 데이터를 저장하는 `holding_decisions` 테이블을 생성했습니다.
* **저장 항목**: 티커, 판단 날짜/시간, 현재가, 매도 여부(`should_sell`), 매도 이유, 확신도, 분석 요약(기술적 추세, 거래량 분석, 시장 환경 영향, 시간 요인), 포트폴리오 조정 정보(조정 필요 여부, 신규 목표가/손절가, 긴급도), 전체 JSON 원본 데이터 등.

**2. AI 판단 자동 저장/삭제 로직**
* **보유 판단 시 (`should_sell=false`)**: `_save_holding_decision()` 메소드를 통해 DB에 최신 판단 결과를 저장하거나 업데이트합니다.
* **매도 판단 시 (`should_sell=true`)**: `_delete_holding_decision()` 메소드를 통해 해당 종목의 판단 데이터를 DB에서 자동으로 삭제합니다.
* 종목(ticker)당 최신 판단 1건만 유지하도록 관리하며, DB 조작 실패 시에도 핵심 매매 로직은 중단 없이 진행되도록 에러 격리 설계를 적용했습니다.

**3. 대시보드 개발 기반 완성**
* 현재 보유 종목별 최신 AI 분석 내용을 실시간으로 조회할 수 있는 기반을 마련했습니다.
* 매도 결정 시 데이터가 자동으로 정리되어 불필요한 이력 없이 최신성 유지가 가능합니다.
* 기술적 추세, 거래량 분석 등 구조화된 데이터와 포트폴리오 조정 제안 사항을 추적할 수 있습니다.

### 📊 기술적 세부사항
* **데이터베이스 확장**: `holding_decisions` 테이블 스키마를 추가하고 하위 호환성을 유지했습니다.
* **로직 통합**: `_analyze_sell_decision()` 메소드 내부에 `should_sell` 분기에 따른 DB 처리 로직을 유기적으로 통합했습니다.
* **안정성 강화**: DB 작업 중 예외가 발생하더라도 매도/보유 결정이라는 핵심 비즈니스 로직은 정상 동작하도록 보호 장치를 마련했습니다.

### 🔄 호환성
* ✅ **기존 기능 완전 호환**: 기존 매매 시뮬레이션 및 자동매매 기능에 영향을 주지 않습니다.
* ✅ **데이터베이스 유지**: 기존 테이블 구조를 유지하면서 새로운 테이블만 추가되었습니다.
* ✅ **API 변경 없음**: 외부 인터페이스의 변경 없이 내부 분석 데이터 관리 기능만 강화되었습니다.

### 📝 대시보드 쿼리 예시
```sql
-- 현재 보유 종목의 최신 AI 판단 조회
SELECT 
    h.ticker,
    h.company_name,
    h.current_price,
    d.should_sell,
    d.sell_reason,
    d.confidence,
    d.technical_trend,
    d.decision_date,
    d.decision_time
FROM stock_holdings h
LEFT JOIN holding_decisions d ON h.ticker = d.ticker
```

---

## Release 8: 매수 보류 종목 추적 시스템 추가 (2025.10.21)

**PRISM-INSIGHT v1.7.0** (PR #53)

### 🎯 변경 목적
매수하지 않은 종목에 대한 분석 데이터를 체계적으로 저장하여 향후 대시보드를 통한 성과 추적 및 전략 개선을 지원합니다. 매수 점수 부족, 산업군 편중, 시장 상황 등으로 보류된 종목의 이후 가격 변동 추이를 분석할 수 있습니다.

### ⭐ 주요 개선 사항
**1. Watchlist History 테이블 추가**
* 매수 보류 종목의 상세 분석 데이터를 저장하는 `watchlist_history` 테이블을 생성했습니다.
* **저장 항목**: 티커, 종목명, 분석 시점 가격, 분석 일시, 매수 점수, 최소 요구 점수, 결정 사유, 목표가/손절가, 산업군, 상세 분석 내용(포트폴리오/밸류에이션/섹터/시장), 전체 시나리오 JSON 데이터 등.

**2. 매수 보류 종목 자동 저장 기능**
* `_save_watchlist_item()` 메소드를 추가하여 보류되는 모든 종목을 자동으로 기록합니다.
* 매수 점수 부족, 산업군 과다 투자, AI의 관망 결정 등 모든 보류 케이스를 누락 없이 추적합니다.
* 기존의 매수/매도 처리 파이프라인과 유기적으로 통합되었습니다.

**3. 향후 대시보드 개발 기반 마련**
* 관망 종목의 실제 가격 변동을 추적하여 매수 점수 임계값(Threshold)의 적절성을 검증할 수 있는 데이터를 확보했습니다.
* 섹터별/이유별 보류 패턴 분석을 통해 데이터 기반의 전략 개선 의사결정을 지원합니다.

### 📊 기술적 세부사항
* **데이터베이스 스키마 확장**: `EnhancedStockTrackingAgent.initialize()`에 테이블 생성 및 자동 마이그레이션 로직을 추가했습니다.
* **로직 통합**: `EnhancedStockTrackingAgent.process_reports()`에서 매수 조건 미달 시 자동으로 저장 로직이 실행되도록 구현했습니다.
* **구조화된 데이터**: 모든 분석 데이터를 JSON 및 개별 컬럼으로 분리하여 쿼리 효율성을 높였습니다.

### 🔄 호환성
* ✅ **기존 기능 완전 호환**: 기존 매매 시뮬레이션 및 자동매매 기능에 영향을 주지 않습니다.
* ✅ **데이터베이스 유지**: 기존 테이블 구조를 유지하면서 새로운 테이블만 추가되었습니다.
* ✅ **API 변경 없음**: 외부 인터페이스의 변경 없이 내부 로직만 강화되었습니다.

---

## Release 7: Docker 지원 추가 및 환경 구축 편의성 개선 (2025.10.19)

**PRISM-INSIGHT v1.6.0** (PR #52)

### 🎯 변경 목적
본 프로젝트를 쉽게 셋팅하고 테스트하도록 지원하여 프로젝트 접근성 향상. `README_DOCKER` 문서 하나를 참고하여 간편하게 도커 빌드 및 환경 셋팅 가능.

### ⭐ 주요 개선 사항
**1. Docker 빌드 환경 구축**
* **빌드 파일 추가**: `Dockerfile`, `docker-compose.yml`, `.dockerignore` 파일을 추가하여 컨테이너 기반 운영 지원
* **OS 기반**: Ubuntu 24.04 LTS 기반의 안정적인 실행 환경 제공

**2. Docker 전용 가이드 제공**
* **README_DOCKER 추가**: 도커 설치, 설정, 실행 및 트러블슈팅을 포함한 상세 가이드 문서 제공

### 📋 상세 변경 사항
* **`Dockerfile`**: Python 3.12 및 Playwright, 한글 폰트 등 필수 의존성이 포함된 이미지 정의
* **`docker-compose.yml`**: 서비스 실행 및 데이터 영속성(볼륨 마운트) 설정을 위한 컴포즈 파일 추가
* **`README_DOCKER_ko.md`**: 도커 환경에서의 셋팅 및 사용법 안내 문서 추가

### 🎬 기대 효과
* **설치 복잡도 감소**: 복잡한 로컬 환경 설정 없이 명령 한 줄로 분석 시스템 가동 가능
* **환경 일관성**: 개발 및 운영 환경의 일치로 환경 차이에 따른 오류 방지
* **빠른 테스트**: 신규 사용자가 프로젝트의 핵심 기능을 즉시 검증할 수 있는 환경 제공

---

## Release 6: 매매 로직 고도화 및 리스크 관리 체계화 (2025.10.16)

**PRISM-INSIGHT v1.5.4** (PR #50)

### 🎯 변경 목적
"손실은 짧게, 수익은 길게!"
올인/올아웃 방식의 특성을 고려하여 진입 시에는 더욱 신중하게, 보유 시에는 추세를 최대한 활용할 수 있도록 매매 로직을 전면 개선했습니다.

### ⭐ 주요 개선 사항
**1. 매수 시점: 리스크 관리 강화**
* **엄격한 손절 제한**: 손절가를 매수가 기준 -5% ~ -7% 이내로 엄격하게 제한
* **Risk/Reward Ratio 필수 적용**: 목표 수익률 대비 손절폭을 계산하여 진입 (예: 목표 수익률 10% → 손절 최대 -5%)
* **진입 금지 원칙**: 지지선이 너무 멀어 손절 폭이 기준을 초과할 경우 진입하지 않는 원칙 확립

**2. 매도 시점: 수익 극대화 전략**
* **추세 추종 보유**: 목표가에 도달하더라도 상승 추세가 강하면 매도하지 않고 수익을 끝까지 추적
* **Trailing Stop 도입**: 목표가 초과 후 고점 대비 -3~5% 하락 시 수익을 확정 짓는 전략 신규 추가
* **전략 세분화**: 투자 기간(단기/중기/장기) 및 시장 환경(강세/약세)에 따른 매도 대응 차별화

**3. 판단 기준 명확화**
* **조정 vs 전환 구분**: 1~2일 하락은 일시적 조정, 3일 이상 하락은 추세 전환으로 판단하는 정량적 기준 수립
* **시장 적응형 전략**: 약세장에서는 방어적(수익 확보 우선), 강세장에서는 공격적(추세 활용)으로 대응 명시

### 📋 상세 변경 사항
* **`stock_tracking_agent.py` (매수 에이전트)**: 리스크 관리 최우선 원칙 섹션 추가 및 기술적 돌파 신호(추세 전환, 박스권 상향 돌파) 세분화
* **`stock_tracking_enhanced_agent.py` (매도 에이전트)**: 매도 결정 우선순위 재구성, Trailing Stop 로직 및 추세 지속/약화 체크리스트 반영

### 🎬 기대 효과
* **손실 최소화**: 엄격한 손절 기준으로 계좌의 치명적인 손실 방지
* **수익 극대화**: Trailing Stop 전략으로 상승 추세를 최대한 활용하여 수익률 제고
* **일관된 판단**: 명확한 체크리스트를 통해 감정을 배제한 원칙 매매 강화

---

## Release 5: 서비스 품질 개선 및 버그 수정 (2025.10.10)

**PRISM-INSIGHT v1.5.3** (PR #49)

### 🎯 변경 목적
서비스 질 상승 및 시스템 안정성 강화

### 🔄 주요 변경사항
**1. 📰 뉴스 에이전트 정확성 개선**
* **프롬프트 고도화**: `firecrawl` 도구를 사용하여 네이버 금융 뉴스 및 공시 페이지에 직접 접속하여 당일 주가 변동 요인을 검색하도록 개선
* **수집 경로**: `https://finance.naver.com/item/news.naver?code={company_code}` URL을 통한 정밀 데이터 수집

**2. 🤖 매매 에이전트 안정화**
* **JSON 파싱 보정 강화**: LLM이 생성한 매매 시나리오 JSON 데이터가 부정확할 경우를 대비한 자동 보정 작업 및 검증 로직 강화
* **파싱 에러 수정**: 구조적 결함이 있는 JSON 응답에 대한 복구 능력 향상

**3. 🐛 메시지 전송 로직 수정**
* **데이터 혼선 방지**: 오전과 오후 트리거가 모두 발생할 경우, 오후 메시지에 오전 데이터가 포함되던 버그 수정
* **독립적 배치 처리**: 각 시간대별 배치 실행 시 데이터 격리 및 메시지 큐 관리 최적화

### 📊 기대 효과
* 뉴스 분석의 신뢰도 및 최신성 확보
* 자동매매 시나리오 생성의 안정성 증대
* 텔레그램 리포트의 정확한 정보 전달

---

## Release 4: AI 기반 시장 분석 강화 및 트레이딩 로직 업그레이드 (2025.09.28)

### 🎯 변경 목적
시장환경과 거시경제를 반영한 매매 신호 제공, AI 프롬프트 기반 로직 전환을 통해 정확도·투명성·유지보수성을 동시에 개선 (PR #34)

### 🔄 주요 변경사항
**1. 📈 시장환경 분석 강화**
* **trading_agent 업그레이드**: 시장환경 및 동종업계 트렌드를 분석에 반영
* **거시경제 통합 분석**: 글로벌 경제 흐름을 고려한 다중 요인 분석으로 매매 신호 정확도 향상

**2. 🤖 AI 프롬프트 기반 로직 전환**
* **규칙 기반 → AI 기반**: 기존의 하드코딩된 매매 로직을 유연한 AI 프롬프트로 이관
* **매도 결정 로직 AI화**: 데이터 기반의 최적 매도 시점 도출 능력 강화 및 코드 단순화

**3. 💬 매매 근거 메시지 보강**
* **상세한 설명 제공**: 매수/매도 사유를 실제 시장 데이터와 함께 상세히 제시
* **투자 보고서 수준**: 분석 리포트 형식으로 메시지를 구성하여 의사결정 과정의 투명성과 신뢰도 강화

**4. 🌍 거시경제 분석 통합**
* **Perplexity-ask 도구 적용**: 실시간 거시경제 동향을 분석 맥락에 즉시 반영
* **비용 및 효율 최적화**: 단일 API 호출로 글로벌 경제 흐름까지 고려한 효율적 데이터 확보

### 🆕 수정된 파일 및 모듈
* **`market_index_agents.py`**: 거시경제 분석 및 지수 분석 기능 추가
* **`trading_agent.py`**: 시장환경 고려 로직 통합 및 프롬프트 고도화
* **`sell_decision_logic.py`**: 규칙 기반 매도 로직을 AI 판단 로직으로 전면 개편
* **매매 근거 메시지 시스템**: 단순 알림에서 전문 분석 리포트 형태로 출력 개선

### 📊 기대 효과
* 시장 상황 변화에 따른 유연한 전략 대응 가능
* 매매 판단의 근거가 명확해져 사용자 신뢰도 향상
* 복잡한 하드코딩 로직 제거로 시스템 유지보수 편의성 증대

---

## Release 3: AI 기반 자동매매 시스템 및 개발자 도구 도입

### 🎯 변경 목적
AI 분석 기반 실제 자동매매 기능 구현 및 개발자 지원 도구 확대

### 🔄 주요 변경사항
**1. 🤖 자동매매 기능 본격 도입**
* **실제 계좌 연동**: 한국투자증권 API를 통한 실제 주식 매매 시스템 구축
* **비동기 매매 엔진**: `AsyncTradingContext`를 활용한 안전한 비동기 주식 거래
* **스마트 매매 전략**: 시간대별 최적 매매 방식 자동 선택 (시장가/지정가/시간외매매/예약주문)
* **포트폴리오 관리**: 실시간 계좌 잔고 조회 및 자동 손익 계산

**2. 📊 매매 에이전트 시스템 강화**
* **에이전트 확장**: 시뮬레이션 매매와 실제 매매 통합 실행 (`stock_tracking_agent.py`, `stock_tracking_enhanced_agent.py`)
* **실시간 매매 로깅**: 매수/매도 성공 여부 및 상세 결과 로깅 시스템 구축

**3. 🔧 개발자 도구 및 테스트 환경 구축**
* **빠른 테스트 도구**: `tests/quick_test.py` - 개별 기능 즉시 테스트
* **종합 테스트 시스템**: `tests/test_async_trading.py` - 전체 매매 시스템 검증
* **포트폴리오 리포터 테스트**: `tests/test_portfolio_reporter.py` - 텔레그램 리포트 기능 검증

**4. 🛡️ 보안 및 안전 기능 강화**
* **모의투자 우선**: 기본값을 모의투자(demo)로 설정하여 안전성 확보
* **이중 확인 시스템**: 실전투자 모드 선택 시 사용자 명시적 확인 절차 추가
* **타임아웃 보호**: 모든 매매 API에 타임아웃 설정으로 무한 대기 방지
* **종목별 락**: 동일 종목 동시 매매 방지를 위한 비동기 락 시스템 도입

### 🆕 신규 파일 및 모듈
* **매매 시스템 핵심**: `trading/domestic_stock_trading.py`, `trading/kis_auth.py`, `trading/config/kis_devlp.yaml.example`
* **테스트 및 검증 도구**: `tests/quick_test.py`, `tests/test_async_trading.py`, `tests/test_portfolio_reporter.py`, `tests/README_async_trading.md`

### 📋 설정 및 환경 개선
**1. 의존성 패키지 추가**
* `PyYAML>=6.0.1`, `pycryptodome>=3.19.0`, `websockets>=12.0`, `cryptography>=42.0.8`

**2. 환경변수 확장**
* `TELEGRAM_AI_BOT_TOKEN`: AI 봇 전용 토큰 추가

**3. .gitignore 보안 강화**
* 매매 관련 보안 정보(KIS 토큰, 키 파일, 설정 파일 등) 제외 설정 강화

### 🎮 사용 방법
**빠른 테스트**
```bash
# 포트폴리오 조회 (모의투자)
python tests/quick_test.py portfolio

# 1만원 매수 테스트 (모의투자)  
python tests/quick_test.py buy

# 전량 매도 테스트 (모의투자)
python tests/quick_test.py sell

# 실전투자 모드 (주의!)
python tests/quick_test.py buy --mode real
```

**종합 테스트**
```bash
# 대화형 테스트 메뉴 실행
python tests/test_async_trading.py
```

### ⚡ 핵심 기능 특징
* **🧠 AI + 실제 매매 연동**: AI 분석 성공 시 실제 계좌에서 자동으로 매매 실행
* **🔄 시간대별 스마트 매매**: 
  * 09:00-15:30: 정규장 시장가 매매
  * 15:40-16:00: 시간외 종가매매
  * 16:00-18:00: 시간외 단일가매매
  * 기타 시간: 예약주문 (다음날 자동 실행)
* **📊 실시간 포트폴리오 관리**: 보유 종목 실시간 조회 및 수익률 자동 계산
* **🛡️ 안전 보장 시스템**: 3단계 보안 락(종목별/세마포어/전역) 및 포괄적 오류 처리

---

## Release 2: 매수 기준 완화 및 모멘텀 전략 강화

### 🎯 변경 목적
기존의 극도로 보수적인 가치투자 방식으로 인해 매수 실행율이 너무 낮아, 좋은 투자 기회들을 과도하게 놓치는 문제를 해결하고자 합니다.

### 🔄 주요 변경사항
**1. 매수 점수 기준 합리화**
* 기본 매수 점수: 8점 → 7점으로 완화
* 포트폴리오 70% 이상 시: 9점 → 8점으로 완화

**2. 프롬프트 개선**
* 에이전트 정체성: "매우 보수적" → "신중하되 모멘텀 고려"
* 매수 점수 해석 기준 조정:
  * 6점: "보통 (모멘텀이 있다면 고려)" 추가
  * 7점: "양호한 매수 기회"로 진입 가능
* 적합성 판단 질문 개선:
  * 기존: "과매도 상태로 매수 적기인가?" (역추세적)
  * 신규: "거래활동 증가나 관심 상승을 보이는가?" (순추세적)

**3. 모멘텀 요소 강화**
* 거래량 급증 시 긍정적 평가
* 투자자별 거래량에서 기관/외인 순매수 시 가산점

### 📊 기대 효과
* 매수 실행율 증가 예상
* 상승 모멘텀 있는 종목들의 기회 포착 개선
* 기존 가치투자 안전장치는 그대로 유지

### ⚠️ 리스크 관리
* 기본적인 재무 건전성, 성장성 검토는 여전히 필수
* 포트폴리오 다양성 제약 조건 유지
* 손절매 시스템 그대로 유지

---

## Release 1: 초기 기능 및 커스터마이징

### 🎯 지원하는 기능
**급등주 포착 조건 예시**
* **거래량 급증** (전일 대비 200% 이상)
* **갭 상승** (5% 이상)
* **시가총액 대비 거래대금 비율**
* **마감 강도 분석**

**분석 보고서 구성**
* **핵심 투자 포인트** - 요약
* **기술적 분석** - 차트 및 지표
* **기본적 분석** - 기업 현황/개요
* **뉴스 분석** - 최근 이슈
* **투자 전략** - 매매 전략

### 🔧 커스터마이징
* **급등주 기준**: `trigger_batch.py`에서 수정 가능
* **AI 프롬프트**: `cores/agents/`에서 에이전트별 수정
* **차트 스타일**: `cores/stock_chart.py`에서 시각화 커스터마이징