# 🚀 릴리즈 노트

## Release 19: Redis Streams 기반 실시간 트레이딩 시그널 Pub/Sub 시스템 추가 (2025.11.22)

**PRISM-INSIGHT v1.10.0** (PR #87)

### 🎯 변경 목적
PRISM-INSIGHT 본체에서 발생하는 매수/매도 시그널을 외부 시스템에서 구독하여 다양하게 활용할 수 있도록 Redis Streams 기반 Pub/Sub 시스템을 도입했습니다. 이를 통해 동일 시그널을 한국투자증권의 다른 계좌에서 동시 매매하거나, 여러 증권사 계좌에 분산 매매, 시그널 기반 커스텀 매매 로직 구현, 시그널 로깅 및 분석 시스템 구축, 텔레그램/슬랙 등 알림 시스템 연동 등 다양한 활용이 가능해집니다.

### ✨ 주요 변경사항
**1. Upstash Redis Streams 시그널 퍼블리셔**
* 매수/매도 실행 시 자동으로 Redis Streams에 시그널을 발행하는 로직이 추가되었습니다.
* 발행되는 시그널은 `type`, `ticker`, `company_name`, `price`, `target_price`, `stop_loss`, `sector`, `rationale` 등 상세한 매매 정보를 포함합니다.

**2. 구독자 예제 스크립트 제공**
* `examples/messaging/redis_subscriber_example.py`에서 시그널을 구독하고 자동매매와 연동하는 예제를 제공합니다.
* `--dry-run` 옵션을 통해 매매 없이 시그널만 확인하는 시뮬레이션 모드를 지원합니다.

**3. Graceful Degradation (점진적 성능 저하)**
* Redis가 설정되지 않으면 시그널 발행을 자동으로 스킵합니다. Upstash Redis 미연동(토큰 미발급) 시 기존 로직에 영향 없이 정상 동작합니다. 기존 사용자는 아무런 추가 설정 없이 그대로 사용할 수 있습니다.

### 🚀 사용 방법
**Step 1: Upstash Redis 생성**
1. Upstash Console에 가입합니다.
2. 새 Redis 데이터베이스를 생성합니다.
3. REST API 탭에서 `UPSTASH_REDIS_REST_URL`과 `UPSTASH_REDIS_REST_TOKEN`을 복사합니다.

**Step 2: 환경변수 설정**
`.env` 파일에 다음을 추가합니다:
```bash
# Redis Streams (Optional - for trading signal pub/sub)
UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_token_here
```

**Step 3: 구독자 실행**
```bash
# 새 메시지만 수신
python examples/messaging/redis_subscriber_example.py
# 처음부터 모든 메시지 수신
python examples/messaging/redis_subscriber_example.py --from-beginning
# 시뮬레이션 모드
python examples/messaging/redis_subscriber_example.py --dry-run
```

---

## Release 18: 매수 로직 정교화 및 자동매매 안정성 강화 (2025.11.18)

**PRISM-INSIGHT v1.9.5** (PR #82, #83, ISSUE #79)

### 🎯 변경 목적
매수 종목 선정 시 확실한 모멘텀(박스권 돌파, 추세 전환, 의미 있는 거래량)이 확인되는 종목 위주로 선별하도록 로직을 강화합니다. 또한, 수능일과 같이 시장 운영 시간이 변동되는 특수 상황에서 예약매매 실패 시 시장가로 재시도하는 보완 로직을 추가하여 자동매매의 실행 신뢰도를 높입니다.

### ⭐ 주요 개선 사항
**1. 매수 에이전트 프롬프트 고도화**
* **모멘텀 필터링 강화**: 단순 상승이 아닌 확실한 박스권 상향 돌파, 기술적 추세 전환, 직전 고점을 뚫는 의미 있는 거래량 동반 여부를 더 엄격하게 판단하도록 프롬프트를 업데이트했습니다.
* **진입 품질 향상**: 속임수 반등을 배제하고 추세의 시작점에 있는 종목 선별력을 높였습니다.

**2. 자동매매 예약매매 실패 보완 로직**
* **시장가 재시도**: 시장 시간 변동 등으로 인해 예약매매(장외)가 실패할 경우, 시스템이 이를 감지하고 시장가 매매로 한 번 더 시도를 수행하여 매매 기회 상실을 방지합니다.

**3. 문서 최신화**
* **README 업데이트**: 프로젝트의 최신 성과 및 변경된 설치/운영 가이드를 반영했습니다.

### 📋 상세 변경 사항
* **`cores/agents/trading_agents.py`**: 매수 에이전트(`trading_scenario_agent`)의 모멘텀 판단 지침 강화
* **`trading/domestic_stock_trading.py`**: 예약매매 실패 시 예외 처리 및 시장가 재주문 로직 구현
* **`README.md` & `README_ko.md`**: 최신 프로젝트 정보 및 가이드 업데이트

### 🎬 기대 효과
* **매매 승률 개선**: 확실한 기술적 근거가 있는 종목에 집중하여 진입 정확도 향상
* **운영 안정성**: 특수 공휴일이나 시장 시간 변경 시에도 중단 없는 자동매매 수행
* **정보 전달력**: 최신화된 문서를 통해 신규 사용자의 원활한 온보딩 지원

---

## Release 17: PDF 변환 엔진 마이그레이션 및 시스템 안정성 강화 (2025.11.13)

**PRISM-INSIGHT v1.9.2** (PR #73, #74, #75)

### 🎯 변경 목적
2023년 이후 유지보수가 중단된 `wkhtmltopdf`를 대체하여 최신 웹 표준을 지원하는 `Playwright (Chromium)` 기반 엔진으로 전환합니다. 이를 통해 PDF 생성의 안정성을 확보하고, `asyncio` 환경에서의 호환성 문제 해결 및 설치 자동화를 구현하여 유지보수성을 대폭 개선했습니다.

### ⭐ 주요 개선 사항
**1. PDF 변환 엔진 교체: wkhtmltopdf → Playwright**
* **Chromium 기반 렌더링**: 최신 HTML/CSS 표준을 완벽하게 지원하여 리포트 디자인의 정확도를 높였습니다.
* **자동 설치 지원**: 첫 실행 시 Chromium 브라우저를 자동으로 다운로드하며, macOS/Linux/Windows(WSL2) 등 모든 플랫폼에서 동일하게 작동합니다.

**2. asyncio 호환성 및 성능 최적화**
* **비동기 루프 충돌 해결**: `ThreadPoolExecutor`를 사용하여 `asyncio` 루프 내에서도 Playwright Sync API가 안전하게 동작하도록 리팩토링했습니다.
* **리소스 최적화**: 브라우저 실행 옵션(`--no-sandbox`, `--disable-dev-shm-usage`)을 최적화하고 PDF 압축 기능을 추가하여 파일 크기를 절감했습니다.

**3. Docker 및 문서화 강화**
* **Dockerfile 최적화**: 불필요한 `wkhtmltopdf` 패키지를 제거하고 Playwright 의존성을 추가했습니다.
* **설치 가이드 제공**: `utils/PLAYWRIGHT_SETUP.md` 및 자동 설치 스크립트(`setup_playwright.sh`)를 추가하여 초기 환경 구축 편의성을 높였습니다.

### 📋 상세 변경 사항
* **`pdf_converter.py`**: Playwright 기반 변환 함수 구현 및 PDF 압축 로직 추가
* **`stock_analysis_orchestrator.py`**: PDF 변환 메서드를 `playwright`로 기본값 변경
* **`Dockerfile` & `docker-compose.yml`**: Playwright 설치 명령 추가 및 로컬 설정 파일 마운트 구조 개선
* **`requirements.txt`**: `playwright>=1.40.0` 의존성 추가
* **`README.md` & `README_ko.md`**: PDF 변환 엔진 변경에 따른 설치 가이드 업데이트

### 📦 설치 및 업그레이드
**로컬 환경**
```bash
pip install -r requirements.txt
python3 -m playwright install chromium
# 또는 자동 설치 스크립트 사용: cd utils && ./setup_playwright.sh
```
**Docker 환경**
```bash
docker-compose build --no-cache
docker-compose up -d
```

### 🎬 기대 효과
* **장기 유지보수성**: 활발히 개발 중인 Playwright 채택으로 시스템 수명 연장
* **안정성**: `asyncio` 환경에서도 데드락 없이 안정적인 리포트 생성 보장
* **편의성**: 브라우저 자동 다운로드로 사용자 설정 단계 최소화

---

## Release 16: 글로벌 확장 및 다국어 브로드캐스팅 시스템 도입 (2025.11.12)

**PRISM-INSIGHT v1.9.0**

### 🎯 변경 목적
PRISM-INSIGHT를 글로벌 사용자를 위한 다국어 지원 시스템으로 확장합니다. 한국 주식시장 분석을 전 세계 투자자들이 자신의 언어로 받아볼 수 있도록 언어 선택 및 다국어 브로드캐스팅 기능을 추가하여 해외 투자자 접근성을 대폭 향상시켰습니다.

### ⭐ 주요 개선 사항
**1. 메인 채널 언어 선택 및 다국어 브로드캐스팅**
* **언어 선택 (`--language`)**: 메인 채널의 리포트 언어를 한국어(ko), 영어(en), 일본어(ja), 중국어(zh) 등으로 자유롭게 선택할 수 있습니다.
* **브로드캐스팅 (`--broadcast-languages`)**: 메인 채널과 별도로 여러 언어 채널에 동시 전송이 가능합니다. (예: `TELEGRAM_CHANNEL_ID_EN` 등 설정 필요)
* **Translation Specialist 추가**: GPT-5-nano 기반의 전문 번역 에이전트를 도입하여 정보의 정확도를 높였습니다. (에이전트 수 12개 → 13개)

**2. 지능형 번역 파이프라인 및 차트 국제화**
* **이미지 보존 번역**: Base64 이미지 차트를 보존하는 placeholder 패턴을 구현하여 번역 후에도 리포트 내 이미지가 완벽하게 복원됩니다.
* **차트 레이블 영문화**: Trading Volume Chart의 투자자 유형 레이블을 영어로 변환하고 한글 범례 깨짐 문제를 해결하여 글로벌 가독성을 높였습니다.

**3. 시스템 안정성 및 아키텍처 개선**
* **비동기 브로드캐스팅**: 메인 파이프라인의 블로킹을 방지하기 위해 번역 및 전송 과정을 비동기로 처리합니다.
* **텔레그램 API 강화**: HTTPXRequest 기반 30초 타임아웃 설정 및 Exponential backoff 재시도 로직을 적용하여 전송 신뢰도를 개선했습니다.

### 📋 상세 변경 사항
* **`stock_analysis_orchestrator.py`**: 언어 파라미터 처리, 번역 파이프라인 및 이미지 추출/복원 로직 구현
* **`telegram_bot_agent.py`**: 타임아웃 설정 및 재시도(Retry) 로직 추가
* **`cores/stock_chart.py`**: 차트 레이블 영문화 매핑 추가
* **`cores/agents/telegram_translator_agent.py` (신규)**: 전문 번역 에이전트 구현
* **`trading/portfolio_telegram_reporter.py`**: 포트폴리오 리포트 비동기 브로드캐스팅 구현
* **`README.md` & `README_ko.md`**: 시즌2 성과 반영, 다국어 사용 예제 추가 및 스폰서 정보 업데이트

### 🎬 기대 효과
* **글로벌 사용자 확대**: 언어 장벽을 제거하여 전 세계 투자자들에게 한국 시장 분석 정보 제공 가능
* **전송 신뢰도 향상**: 네트워크 불안정 상황에서도 안정적인 메시지 전송 보장
* **정보 정확도**: 전문 번역 에이전트를 통한 고품질 리포트 제공

---

## Release 15: 텔레그램 선택적 사용 기능 추가 및 성능 최적화 (2025.11.02)

**PRISM-INSIGHT v1.8.0** (PR #65, ISSUE #64)

### 🎯 변경 목적
텔레그램 설정 없이도 핵심 분석 기능을 테스트할 수 있도록 로컬 개발 환경의 진입 장벽을 제거합니다. 불필요한 메시지 생성 및 전송 과정을 스킵하여 성능을 최적화하고, 사용자의 환경에 따른 유연한 실행 옵션을 제공합니다.

### ⭐ 주요 개선 사항
**1. `--no-telegram` CLI 옵션 추가**
* **유연한 실행**: 텔레그램 API 키나 채널 ID 설정 없이도 `급등주 포착 → 보고서 생성 → PDF 변환 → 트래킹 시스템`의 핵심 파이프라인을 정상적으로 실행할 수 있습니다.
* **비용 절감**: 텔레그램용 AI 요약 메시지 생성 단계를 스킵하여 API 호출 비용을 절감합니다.

**2. `TelegramConfig` 클래스 도입 (SOLID 원칙 준수)**
* **설정 중앙화**: 텔레그램 관련 설정을 하나의 클래스에서 관리하며, 의존성 주입 패턴을 적용하여 코드의 유지보수성을 높였습니다.
* **자동 환경변수 로드**: `.env` 파일을 자동으로 감지하고 로드하며, 설정 누락 시 명확한 가이드 메시지를 제공합니다.

**3. 파이프라인 최적화**
* **속도 개선**: 텔레그램 비활성화 시 메시지 생성/전송 및 관련 파일 I/O가 스킵되어 전체 실행 시간이 **30~50% 단축**됩니다.

### 📋 상세 변경 사항
* **`telegram_config.py` (신규)**: `TelegramConfig` 클래스 구현 및 설정 검증 로직 추가
* **`TELEGRAM_USAGE.md` (신규)**: 텔레그램 옵션 상세 가이드 및 문제 해결 문서 추가
* **`stock_analysis_orchestrator.py`**: `--no-telegram` 옵션 처리 및 파이프라인 조건부 실행 로직 반영
* **`stock_tracking_agent.py`**: 텔레그램 전송 실패나 미사용 시에도 트래킹 배치가 중단되지 않도록 개선
* **`README.md`**: 기본 실행 섹션 및 필수 설정 파일 안내 업데이트

### 🎬 기대 효과
* **개발 효율성**: 로컬 환경에서 텔레그램 설정 없이 즉시 핵심 로직 테스트 가능
* **성능 향상**: 불필요한 네트워크 호출 및 AI 생성 비용 제거
* **사용자 경험**: 에러 메시지 개선 및 명확한 사용 가이드 제공을 통한 진입 장벽 완화

---

## Release 14: 매도 전략 고도화 및 시장 환경 기반 차별화 전략 도입 (2025.11.01)

**PRISM-INSIGHT v1.7.7** (PR #63)

### 🎯 변경 목적
대한전선 사례 분석 결과, 목표가 도달 후에도 강세 추세 지속 시 조기 매도로 추가 수익 기회 상실 확인. 시장 환경에 따른 유연한 매도 전략을 통해 강세장에서는 수익을 극대화하고, 약세장에서는 방어적 익절로 수익률을 개선합니다.

### ⭐ 주요 개선 사항
**1. 시장 환경 기반 매도 전략 차별화**
* **시장 환경 파악 (0단계)**: KOSPI/KOSDAQ 20일 이동평균선, 수급(외인/기관), 거래량 등을 종합하여 강세장과 약세장/횡보장을 구분합니다.
* **강세장 모드 (추세 우선)**: 목표가는 최소 기준일뿐, 추세가 살아있으면 계속 보유합니다. Trailing Stop 범위를 고점 대비 **-8~10%**로 확대하여 노이즈를 견디고 수익을 극대화합니다.
* **약세장/횡보장 모드 (수익 확보)**: 목표가 도달 시 즉시 매도를 고려하며, Trailing Stop을 고점 대비 **-3~5%**로 타이트하게 유지하여 방어적으로 대응합니다.

**2. 매수 에이전트 market_condition 필드 명시화**
* **용어 통일**: 매수 에이전트의 JSON 응답 필드 설명을 "시장 추세 분석 (상승추세/하락추세/횡보)"으로 개선하여 매도 에이전트와의 판단 일관성을 확보했습니다.

### 📋 상세 변경 사항
* **`stock_tracking_enhanced_agent.py` & `cores/agents/trading_agents.py`**: 
    - 매도 에이전트 instruction 전면 개편
    - "0단계: 시장 환경 파악" 섹션 추가
    - 수익 실현 섹션을 시장 환경별(강세/약세) 모드로 분리
    - Trailing Stop 기준 차별화 (-8~10% vs -3~5%)
* **`stock_tracking_agent.py`**: `market_condition` 필드 설명 명시화 및 에이전트 간 용어 통일

### 🎬 기대 효과
* **수익률 제고**: 강세장에서의 조기 매도를 방지하여 추세 상승분을 최대한 확보
* **리스크 관리**: 약세장에서의 빠른 익절을 통해 변동성 장세에서의 수익 보존
* **판단 일관성**: 매수부터 매도까지 시장 상황에 대한 통일된 분류 체계 적용

---

## Release 13: 동전주 필터링 강화 및 종목 선별 정확도 향상 (2025.10.30)

**PRISM-INSIGHT v1.7.6** (PR #62)

### 🎯 변경 목적
저시가총액 동전주 제외를 통한 투자 안정성 향상 및 유동성이 확보된 신뢰성 있는 종목 위주의 선별 강화

### ⭐ 주요 개선 사항
**1. 동전주 필터링 로직 추가**
* **적용 범위**: 모든 오전/오후 트리거 알고리즘(6종)에 일괄 적용
* **기준 상향**: 시가총액 필터 기준을 기존 100억원에서 **500억원 이상**으로 상향하여 변동성이 큰 소형주 배제
* **데이터 연동**: 모든 트리거 함수에 시가총액 데이터(`cap_df`) 파라미터를 추가하고 필터링 로직을 적용하여 정밀한 스크리닝 수행

**2. 종목 평가 기준 명시화**
* **저가주 판단 기준**: 주가 1,000원 이하의 동전주를 종목 평가 6점 이하(매수 부적합) 항목에 명시적으로 추가
* **AI 판단력 강화**: AI 에이전트가 저가 종목에 대한 명확한 판단 기준을 확보하여 의사결정 신뢰도 향상

### 📋 상세 변경 사항
* **`trigger_batch.py`**: 
    - 6개 트리거 함수 전체에 시가총액 데이터 병합 로직 추가
    - 필터링 적용 후 남은 종목 수에 대한 디버그 로깅 추가
* **`stock_tracking_agent.py`**: 종목 평가 기준 가이드라인에 "1,000원 이하 동전주 제외" 원칙 명시

### 🎬 기대 효과
* **리스크 관리**: 급격한 변동성 및 시세 조작 가능성이 높은 저시가총액 종목 자동 필터링
* **유동성 확보**: 충분한 시가총액을 가진 중대형주 위주의 포트폴리오 구성 지원
* **분석 효율화**: 부적합 종목을 1차 스크리닝하여 AI 분석 리소스 낭비 방지

---

## Release 12: 오전장 대응 강화 및 대시보드 가독성 개선 (2025.10.29)

**PRISM-INSIGHT v1.7.5** (PR #60, #61)

### 🎯 변경 목적
오전장 매매 정확성 향상 및 대시보드 사용자 경험(UX) 개선

### ⭐ 주요 개선 사항
**1. 매수/매도 에이전트 프롬프트 수정 (오전장 대응 정확도 향상)**
* **시간 기반 분석 로직 도입**: `time-get_current_time` 도구를 사용하여 현재 시간을 확인하고, 장중 데이터와 장 마감 후 데이터를 차별화하여 분석하도록 개선했습니다.
* **장중(09:00~15:20) 분석 원칙**: 당일 거래량/캔들은 미완성 데이터로 간주하여 "거래량 부족" 등의 확정적 판단을 금지하고, 전일 확정 데이터 중심으로 분석하도록 지침을 강화했습니다.
* **장 마감 후(15:30 이후) 분석 원칙**: 당일의 모든 기술적 지표를 신뢰할 수 있는 데이터로 활용하여 적극적인 분석을 수행합니다.

**2. 대시보드 가독성 및 정보량 확대**
* **손절가 변경 이력 시각화**: 'AI 보유 분석' 탭에서 포트폴리오 조정(Trailing Stop 등)으로 인한 손절가 변경 내역이 명확하게 표시되도록 수정했습니다.
* **매매 시나리오 추가**: '거래내역' 탭에서 각 종목의 진입 당시 AI가 작성했던 상세 매매 시나리오를 확인할 수 있는 기능을 추가했습니다.

**3. 데이터 관리 정책 최적화**
* **관망종목 30일 보유 정책**: `watchlist_history` 데이터의 보관 기간을 30일로 설정하여, 불필요한 과거 데이터 누적으로 인한 대시보드 스크롤 부하를 방지하고 시스템 성능을 최적화했습니다.

### 📋 상세 변경 사항
* **`cores/agents/trading_agents.py`**: 장중/장후 데이터 신뢰도 판단 기준 프롬프트 추가
* **`examples/dashboard/`**: 손절가 변경 로직 반영 및 거래내역 상세 모달 내 시나리오 섹션 추가
* **`stock_tracking_enhanced_agent.py`**: 관망종목 데이터 자동 정리(Cleanup) 로직 강화

### 🎬 기대 효과
* **판단 오류 감소**: 데이터가 완성되지 않은 오전장에 발생할 수 있는 AI의 성급한 판단 방지
* **복기 기능 강화**: 과거 거래의 시나리오를 대시보드에서 즉시 확인하여 전략 개선에 활용
* **쾌적한 UI**: 데이터 최신성 유지 및 대시보드 로딩 속도 개선

---

## Release 11: 실시간 성과 대시보드 프론트엔드 도입 (2025.10.29)

**PRISM-INSIGHT v1.7.4** (PR #57, #58, #59)
* **공식 대시보드**: [https://analysis.stocksimulation.kr](https://analysis.stocksimulation.kr)

### 🎯 변경 목적
PRISM-INSIGHT의 매매 시뮬레이션 및 실전투자 성과를 투명하게 실시간으로 모니터링할 수 있는 웹 대시보드를 제공합니다. 사용자에게 직관적인 데이터 시각화와 AI 의사결정 분석 인터페이스를 제공하여 프로젝트의 신뢰성을 강화하고 커뮤니티 유입을 촉진합니다.

### ⭐ 주요 개선 사항
**1. Next.js 기반 실시간 대시보드 추가**
* **기술 스택**: Next.js 16 + React 19 + TypeScript + Tailwind CSS
* **주요 페이지**:
  * **대시보드**: 핵심 지표(수익률, 승률), 포트폴리오 현황, 시장 지수 차트
  * **AI 보유 분석**: AI 에이전트의 종목별 상세 의사결정 근거 분석
  * **거래 내역**: 과거 매매 기록 및 상세 수익률 통계
  * **관심 종목**: 현재 AI가 모니터링 중인 잠재적 진입 후보 리스트

**2. 시각화 및 인터랙티브 컴포넌트**
* **핵심 지표 카드**: 누적 수익률, 승률, 보유 종목 수 등 주요 KPI 시각화
* **성과 차트**: Recharts를 활용한 KOSPI/KOSDAQ 지수 대비 성과 비교
* **종목 상세 모달**: 클릭 시 해당 종목의 AI 분석 리포트 요약 및 지표 팝업

**3. 프로젝트 브랜딩 및 소셜 통합**
* **Header**: "Open Source" 뱃지, GitHub/Telegram 바로가기, 테마 전환(다크/라이트) 지원
* **Footer**: 프로젝트 소개, 사용된 AI 모델 정보(GPT-4.1, GPT-5, Claude 4.5), 면책 조항 명시

**4. 데이터 자동 갱신 시스템**
* **배치 스크립트**: `generate_dashboard_json.py`를 통한 주기적 데이터 추출
* **자동화**: Crontab을 활용하여 매일 2회(11:05, 17:05) 최신 시장 데이터 반영

### 📁 새로운 파일 구조 (`examples/dashboard/`)
* `app/`: Next.js App Router 기반 페이지 및 레이아웃
* `components/`: 헤더, 푸터, 차트, 테이블 등 재사용 가능한 UI 컴포넌트
* `types/` & `lib/`: TypeScript 타입 정의 및 유틸리티 함수
* `DASHBOARD_README.md`: 대시보드 전용 설치 및 설정 가이드

### 🎨 디자인 특징
* **반응형 UI**: 모바일, 태블릿, 데스크톱 환경에 최적화된 레이아웃
* **브랜드 일관성**: Primary-Purple-Blue 그라데이션을 활용한 세련된 디자인
* **접근성**: ARIA 속성 및 키보드 네비게이션 지원

### 📊 데이터 구조 (`dashboard_data.json`)
대시보드는 다음 구조화된 데이터를 로드하여 표시합니다:
* `summary`: 전체 요약 통계
* `holdings` & `real_portfolio`: 시뮬레이션 및 실전 계좌 현황
* `trading_history`: 과거 거래 이력
* `watchlist`: AI 관심 종목
* `market_condition`: 시장 지수 데이터

### 🚀 배포 및 설정
**설치 및 실행**
```bash
cd examples/dashboard
npm install react-is --legacy-peer-deps
npm run build
pm2 start npm --name "dashboard" -- start
```

**Crontab 데이터 갱신 설정**
```bash
# 매일 오전 11:05, 오후 17:05 데이터 갱신
05 11 * * * cd /project-root/examples && python generate_dashboard_json.py >> /project-root/logs/generate_dashboard_json.log 2>&1
05 17 * * * cd /project-root/examples && python generate_dashboard_json.py >> /project-root/logs/generate_dashboard_json.log 2>&1
```

---

## Release 10: MCP 서버 프로세스 누적 방지 및 싱글톤 패턴 적용 (2025.10.25)

**PRISM-INSIGHT v1.7.3** (PR #56)

### 🎯 변경 목적
매 요청마다 새로운 `MCPApp` 인스턴스가 생성되어 `kospi_kosdaq_stock_server` 프로세스가 누적되는 문제를 해결합니다. 이를 통해 메모리 및 CPU 리소스 고갈을 방지하고 시스템의 전반적인 안정성과 성능을 향상시킵니다.

### ⭐ 주요 개선 사항
**1. 전역 MCPApp 싱글톤 패턴 도입**
* `get_or_create_global_mcp_app()` 함수를 통해 단일 인스턴스를 관리합니다.
* 서버 프로세스를 한 번만 생성하고 재사용함으로써 리소스 효율성을 획기적으로 개선했습니다.

**2. 자동 리소스 정리 메커니즘 강화**
* `cleanup_global_mcp_app()` 함수로 명시적인 리소스 정리를 지원합니다.
* `atexit` 핸들러를 등록하여 프로그램 종료 시 프로세스가 자동으로 정리되도록 보장합니다.
* 오류 발생 시 시스템을 복구할 수 있는 자동 재시작 기능(`reset_global_mcp_app()`)을 추가했습니다.

**3. 봇 생명주기 관리 개선**
* 봇 시작 시 전역 `MCPApp`을 초기화하고, 종료 시 정리를 수행합니다.
* Agent 연결 지속성 설정(`connection_persistence=True`)을 통해 불필요한 재연결 비용을 줄였습니다.

**4. AI 프롬프트 최적화 (원상복구)**
* v1.7.2에서 현재 날짜 강조를 위해 지나치게 길어졌던 프롬프트를 기존의 효율적인 형태로 원상복구했습니다. (기존 프롬프트로도 충분한 정확도 확인)

### 🐛 버그 수정
* 매 요청마다 새로운 MCP 서버 프로세스가 생성되어 서버 리소스가 고갈되던 치명적인 버그를 수정했습니다.
* 프로세스 미정리로 인해 서버가 응답하지 않던 현상을 해결했습니다.

### 🔄 호환성
* ✅ **기존 기능 완전 호환**: 내부적인 인스턴스 관리 방식만 변경되었습니다.
* ✅ **리소스 효율성**: 동일 사양 서버에서 더 많은 요청을 안정적으로 처리할 수 있습니다.

---

## Release 9: 보유 종목 보유 사유 추적 시스템 추가 (2025.10.23)

**PRISM-INSIGHT v1.7.1** (PR #54)

### 🎯 변경 목적
보유 종목에 대한 보유 판단 데이터를 체계적으로 저장하여 대시보드에서 최신 AI 분석 내용을 표시할 수 있도록 합니다. 매도 시 자동으로 보유 사유 데이터를 삭제하여 현재 보유 중인 종목의 최신 분석 결과만 효율적으로 관리합니다.

### ⭐ 주요 개선 사항
**1. Holding Decisions 테이블 추가**
* 보유 종목의 AI 매도 판단 데이터를 저장하는 `holding_decisions` 테이블을 생성했습니다.
* **저장 항목**: 티커, 판단 날짜/시간, 현재가, 매도 여부(`should_sell`), 매도 이유, 확신도, 분석 요약(기술적 추세, 거래량 분석, 시장 환경 영향, 시간 요인), 포트폴리오 조정 정보(조정 필요 여부, 신규 목표가/손절가, 긴급도), 전체 JSON 원본 데이터 등.

**2. AI 판단 자동 저장/삭제 로직**
* **보유 판단 시 (`should_sell=false`)**: `_save_holding_decision()` 메소드를 통해 DB에 최신 판단 결과를 저장하거나 업데이트합니다.
* **매도 판단 시 (`should_sell=true`)**: `_delete_holding_decision()` 메소드를 통해 해당 종목의 판단 데이터를 DB에서 자동으로 삭제합니다.
* 종목(ticker)당 최신 판단 1건만 유지하도록 관리하며, DB 조작 실패 시에도 핵심 매매 로직은 중단 없이 진행되도록 에러 격리 설계를 적용했습니다.

**3. 대시보드 개발 기반 완성**
* 현재 보유 종목별 최신 AI 분석 내용을 실시간으로 조회할 수 있는 기반을 마련했습니다.
* 매도 결정 시 데이터가 자동으로 정리되어 불필요한 이력 없이 최신성 유지가 가능합니다.
* 기술적 추세, 거래량 분석 등 구조화된 데이터와 포트폴리오 조정 제안 사항을 추적할 수 있습니다.

### 📊 기술적 세부사항
* **데이터베이스 확장**: `holding_decisions` 테이블 스키마를 추가하고 하위 호환성을 유지했습니다.
* **로직 통합**: `_analyze_sell_decision()` 메소드 내부에 `should_sell` 분기에 따른 DB 처리 로직을 유기적으로 통합했습니다.
* **안정성 강화**: DB 작업 중 예외가 발생하더라도 매도/보유 결정이라는 핵심 비즈니스 로직은 정상 동작하도록 보호 장치를 마련했습니다.

### 🔄 호환성
* ✅ **기존 기능 완전 호환**: 기존 매매 시뮬레이션 및 자동매매 기능에 영향을 주지 않습니다.
* ✅ **데이터베이스 유지**: 기존 테이블 구조를 유지하면서 새로운 테이블만 추가되었습니다.
* ✅ **API 변경 없음**: 외부 인터페이스의 변경 없이 내부 분석 데이터 관리 기능만 강화되었습니다.

### 📝 대시보드 쿼리 예시
```sql
-- 현재 보유 종목의 최신 AI 판단 조회
SELECT 
    h.ticker,
    h.company_name,
    h.current_price,
    d.should_sell,
    d.sell_reason,
    d.confidence,
    d.technical_trend,
    d.decision_date,
    d.decision_time
FROM stock_holdings h
LEFT JOIN holding_decisions d ON h.ticker = d.ticker
```

---

## Release 8: 매수 보류 종목 추적 시스템 추가 (2025.10.21)

**PRISM-INSIGHT v1.7.0** (PR #53)

### 🎯 변경 목적
매수하지 않은 종목에 대한 분석 데이터를 체계적으로 저장하여 향후 대시보드를 통한 성과 추적 및 전략 개선을 지원합니다. 매수 점수 부족, 산업군 편중, 시장 상황 등으로 보류된 종목의 이후 가격 변동 추이를 분석할 수 있습니다.

### ⭐ 주요 개선 사항
**1. Watchlist History 테이블 추가**
* 매수 보류 종목의 상세 분석 데이터를 저장하는 `watchlist_history` 테이블을 생성했습니다.
* **저장 항목**: 티커, 종목명, 분석 시점 가격, 분석 일시, 매수 점수, 최소 요구 점수, 결정 사유, 목표가/손절가, 산업군, 상세 분석 내용(포트폴리오/밸류에이션/섹터/시장), 전체 시나리오 JSON 데이터 등.

**2. 매수 보류 종목 자동 저장 기능**
* `_save_watchlist_item()` 메소드를 추가하여 보류되는 모든 종목을 자동으로 기록합니다.
* 매수 점수 부족, 산업군 과다 투자, AI의 관망 결정 등 모든 보류 케이스를 누락 없이 추적합니다.
* 기존의 매수/매도 처리 파이프라인과 유기적으로 통합되었습니다.

**3. 향후 대시보드 개발 기반 마련**
* 관망 종목의 실제 가격 변동을 추적하여 매수 점수 임계값(Threshold)의 적절성을 검증할 수 있는 데이터를 확보했습니다.
* 섹터별/이유별 보류 패턴 분석을 통해 데이터 기반의 전략 개선 의사결정을 지원합니다.

### 📊 기술적 세부사항
* **데이터베이스 스키마 확장**: `EnhancedStockTrackingAgent.initialize()`에 테이블 생성 및 자동 마이그레이션 로직을 추가했습니다.
* **로직 통합**: `EnhancedStockTrackingAgent.process_reports()`에서 매수 조건 미달 시 자동으로 저장 로직이 실행되도록 구현했습니다.
* **구조화된 데이터**: 모든 분석 데이터를 JSON 및 개별 컬럼으로 분리하여 쿼리 효율성을 높였습니다.

### 🔄 호환성
* ✅ **기존 기능 완전 호환**: 기존 매매 시뮬레이션 및 자동매매 기능에 영향을 주지 않습니다.
* ✅ **데이터베이스 유지**: 기존 테이블 구조를 유지하면서 새로운 테이블만 추가되었습니다.
* ✅ **API 변경 없음**: 외부 인터페이스의 변경 없이 내부 로직만 강화되었습니다.

---

## Release 7: Docker 지원 추가 및 환경 구축 편의성 개선 (2025.10.19)

**PRISM-INSIGHT v1.6.0** (PR #52)

### 🎯 변경 목적
본 프로젝트를 쉽게 셋팅하고 테스트하도록 지원하여 프로젝트 접근성 향상. `README_DOCKER` 문서 하나를 참고하여 간편하게 도커 빌드 및 환경 셋팅 가능.

### ⭐ 주요 개선 사항
**1. Docker 빌드 환경 구축**
* **빌드 파일 추가**: `Dockerfile`, `docker-compose.yml`, `.dockerignore` 파일을 추가하여 컨테이너 기반 운영 지원
* **OS 기반**: Ubuntu 24.04 LTS 기반의 안정적인 실행 환경 제공

**2. Docker 전용 가이드 제공**
* **README_DOCKER 추가**: 도커 설치, 설정, 실행 및 트러블슈팅을 포함한 상세 가이드 문서 제공

### 📋 상세 변경 사항
* **`Dockerfile`**: Python 3.12 및 Playwright, 한글 폰트 등 필수 의존성이 포함된 이미지 정의
* **`docker-compose.yml`**: 서비스 실행 및 데이터 영속성(볼륨 마운트) 설정을 위한 컴포즈 파일 추가
* **`README_DOCKER_ko.md`**: 도커 환경에서의 셋팅 및 사용법 안내 문서 추가

### 🎬 기대 효과
* **설치 복잡도 감소**: 복잡한 로컬 환경 설정 없이 명령 한 줄로 분석 시스템 가동 가능
* **환경 일관성**: 개발 및 운영 환경의 일치로 환경 차이에 따른 오류 방지
* **빠른 테스트**: 신규 사용자가 프로젝트의 핵심 기능을 즉시 검증할 수 있는 환경 제공

---

## Release 6: 매매 로직 고도화 및 리스크 관리 체계화 (2025.10.16)

**PRISM-INSIGHT v1.5.4** (PR #50)

### 🎯 변경 목적
"손실은 짧게, 수익은 길게!"
올인/올아웃 방식의 특성을 고려하여 진입 시에는 더욱 신중하게, 보유 시에는 추세를 최대한 활용할 수 있도록 매매 로직을 전면 개선했습니다.

### ⭐ 주요 개선 사항
**1. 매수 시점: 리스크 관리 강화**
* **엄격한 손절 제한**: 손절가를 매수가 기준 -5% ~ -7% 이내로 엄격하게 제한
* **Risk/Reward Ratio 필수 적용**: 목표 수익률 대비 손절폭을 계산하여 진입 (예: 목표 수익률 10% → 손절 최대 -5%)
* **진입 금지 원칙**: 지지선이 너무 멀어 손절 폭이 기준을 초과할 경우 진입하지 않는 원칙 확립

**2. 매도 시점: 수익 극대화 전략**
* **추세 추종 보유**: 목표가에 도달하더라도 상승 추세가 강하면 매도하지 않고 수익을 끝까지 추적
* **Trailing Stop 도입**: 목표가 초과 후 고점 대비 -3~5% 하락 시 수익을 확정 짓는 전략 신규 추가
* **전략 세분화**: 투자 기간(단기/중기/장기) 및 시장 환경(강세/약세)에 따른 매도 대응 차별화

**3. 판단 기준 명확화**
* **조정 vs 전환 구분**: 1~2일 하락은 일시적 조정, 3일 이상 하락은 추세 전환으로 판단하는 정량적 기준 수립
* **시장 적응형 전략**: 약세장에서는 방어적(수익 확보 우선), 강세장에서는 공격적(추세 활용)으로 대응 명시

### 📋 상세 변경 사항
* **`stock_tracking_agent.py` (매수 에이전트)**: 리스크 관리 최우선 원칙 섹션 추가 및 기술적 돌파 신호(추세 전환, 박스권 상향 돌파) 세분화
* **`stock_tracking_enhanced_agent.py` (매도 에이전트)**: 매도 결정 우선순위 재구성, Trailing Stop 로직 및 추세 지속/약화 체크리스트 반영

### 🎬 기대 효과
* **손실 최소화**: 엄격한 손절 기준으로 계좌의 치명적인 손실 방지
* **수익 극대화**: Trailing Stop 전략으로 상승 추세를 최대한 활용하여 수익률 제고
* **일관된 판단**: 명확한 체크리스트를 통해 감정을 배제한 원칙 매매 강화

---

## Release 5: 서비스 품질 개선 및 버그 수정 (2025.10.10)

**PRISM-INSIGHT v1.5.3** (PR #49)

### 🎯 변경 목적
서비스 질 상승 및 시스템 안정성 강화

### 🔄 주요 변경사항
**1. 📰 뉴스 에이전트 정확성 개선**
* **프롬프트 고도화**: `firecrawl` 도구를 사용하여 네이버 금융 뉴스 및 공시 페이지에 직접 접속하여 당일 주가 변동 요인을 검색하도록 개선
* **수집 경로**: `https://finance.naver.com/item/news.naver?code={company_code}` URL을 통한 정밀 데이터 수집

**2. 🤖 매매 에이전트 안정화**
* **JSON 파싱 보정 강화**: LLM이 생성한 매매 시나리오 JSON 데이터가 부정확할 경우를 대비한 자동 보정 작업 및 검증 로직 강화
* **파싱 에러 수정**: 구조적 결함이 있는 JSON 응답에 대한 복구 능력 향상

**3. 🐛 메시지 전송 로직 수정**
* **데이터 혼선 방지**: 오전과 오후 트리거가 모두 발생할 경우, 오후 메시지에 오전 데이터가 포함되던 버그 수정
* **독립적 배치 처리**: 각 시간대별 배치 실행 시 데이터 격리 및 메시지 큐 관리 최적화

### 📊 기대 효과
* 뉴스 분석의 신뢰도 및 최신성 확보
* 자동매매 시나리오 생성의 안정성 증대
* 텔레그램 리포트의 정확한 정보 전달

---

## Release 4: AI 기반 시장 분석 강화 및 트레이딩 로직 업그레이드 (2025.09.28)

### 🎯 변경 목적
시장환경과 거시경제를 반영한 매매 신호 제공, AI 프롬프트 기반 로직 전환을 통해 정확도·투명성·유지보수성을 동시에 개선 (PR #34)

### 🔄 주요 변경사항
**1. 📈 시장환경 분석 강화**
* **trading_agent 업그레이드**: 시장환경 및 동종업계 트렌드를 분석에 반영
* **거시경제 통합 분석**: 글로벌 경제 흐름을 고려한 다중 요인 분석으로 매매 신호 정확도 향상

**2. 🤖 AI 프롬프트 기반 로직 전환**
* **규칙 기반 → AI 기반**: 기존의 하드코딩된 매매 로직을 유연한 AI 프롬프트로 이관
* **매도 결정 로직 AI화**: 데이터 기반의 최적 매도 시점 도출 능력 강화 및 코드 단순화

**3. 💬 매매 근거 메시지 보강**
* **상세한 설명 제공**: 매수/매도 사유를 실제 시장 데이터와 함께 상세히 제시
* **투자 보고서 수준**: 분석 리포트 형식으로 메시지를 구성하여 의사결정 과정의 투명성과 신뢰도 강화

**4. 🌍 거시경제 분석 통합**
* **Perplexity-ask 도구 적용**: 실시간 거시경제 동향을 분석 맥락에 즉시 반영
* **비용 및 효율 최적화**: 단일 API 호출로 글로벌 경제 흐름까지 고려한 효율적 데이터 확보

### 🆕 수정된 파일 및 모듈
* **`market_index_agents.py`**: 거시경제 분석 및 지수 분석 기능 추가
* **`trading_agent.py`**: 시장환경 고려 로직 통합 및 프롬프트 고도화
* **`sell_decision_logic.py`**: 규칙 기반 매도 로직을 AI 판단 로직으로 전면 개편
* **매매 근거 메시지 시스템**: 단순 알림에서 전문 분석 리포트 형태로 출력 개선

### 📊 기대 효과
* 시장 상황 변화에 따른 유연한 전략 대응 가능
* 매매 판단의 근거가 명확해져 사용자 신뢰도 향상
* 복잡한 하드코딩 로직 제거로 시스템 유지보수 편의성 증대

---

## Release 3: AI 기반 자동매매 시스템 및 개발자 도구 도입

### 🎯 변경 목적
AI 분석 기반 실제 자동매매 기능 구현 및 개발자 지원 도구 확대

### 🔄 주요 변경사항
**1. 🤖 자동매매 기능 본격 도입**
* **실제 계좌 연동**: 한국투자증권 API를 통한 실제 주식 매매 시스템 구축
* **비동기 매매 엔진**: `AsyncTradingContext`를 활용한 안전한 비동기 주식 거래
* **스마트 매매 전략**: 시간대별 최적 매매 방식 자동 선택 (시장가/지정가/시간외매매/예약주문)
* **포트폴리오 관리**: 실시간 계좌 잔고 조회 및 자동 손익 계산

**2. 📊 매매 에이전트 시스템 강화**
* **에이전트 확장**: 시뮬레이션 매매와 실제 매매 통합 실행 (`stock_tracking_agent.py`, `stock_tracking_enhanced_agent.py`)
* **실시간 매매 로깅**: 매수/매도 성공 여부 및 상세 결과 로깅 시스템 구축

**3. 🔧 개발자 도구 및 테스트 환경 구축**
* **빠른 테스트 도구**: `tests/quick_test.py` - 개별 기능 즉시 테스트
* **종합 테스트 시스템**: `tests/test_async_trading.py` - 전체 매매 시스템 검증
* **포트폴리오 리포터 테스트**: `tests/test_portfolio_reporter.py` - 텔레그램 리포트 기능 검증

**4. 🛡️ 보안 및 안전 기능 강화**
* **모의투자 우선**: 기본값을 모의투자(demo)로 설정하여 안전성 확보
* **이중 확인 시스템**: 실전투자 모드 선택 시 사용자 명시적 확인 절차 추가
* **타임아웃 보호**: 모든 매매 API에 타임아웃 설정으로 무한 대기 방지
* **종목별 락**: 동일 종목 동시 매매 방지를 위한 비동기 락 시스템 도입

### 🆕 신규 파일 및 모듈
* **매매 시스템 핵심**: `trading/domestic_stock_trading.py`, `trading/kis_auth.py`, `trading/config/kis_devlp.yaml.example`
* **테스트 및 검증 도구**: `tests/quick_test.py`, `tests/test_async_trading.py`, `tests/test_portfolio_reporter.py`, `tests/README_async_trading.md`

### 📋 설정 및 환경 개선
**1. 의존성 패키지 추가**
* `PyYAML>=6.0.1`, `pycryptodome>=3.19.0`, `websockets>=12.0`, `cryptography>=42.0.8`

**2. 환경변수 확장**
* `TELEGRAM_AI_BOT_TOKEN`: AI 봇 전용 토큰 추가

**3. .gitignore 보안 강화**
* 매매 관련 보안 정보(KIS 토큰, 키 파일, 설정 파일 등) 제외 설정 강화

### 🎮 사용 방법
**빠른 테스트**
```bash
# 포트폴리오 조회 (모의투자)
python tests/quick_test.py portfolio

# 1만원 매수 테스트 (모의투자)  
python tests/quick_test.py buy

# 전량 매도 테스트 (모의투자)
python tests/quick_test.py sell

# 실전투자 모드 (주의!)
python tests/quick_test.py buy --mode real
```

**종합 테스트**
```bash
# 대화형 테스트 메뉴 실행
python tests/test_async_trading.py
```

### ⚡ 핵심 기능 특징
* **🧠 AI + 실제 매매 연동**: AI 분석 성공 시 실제 계좌에서 자동으로 매매 실행
* **🔄 시간대별 스마트 매매**: 
  * 09:00-15:30: 정규장 시장가 매매
  * 15:40-16:00: 시간외 종가매매
  * 16:00-18:00: 시간외 단일가매매
  * 기타 시간: 예약주문 (다음날 자동 실행)
* **📊 실시간 포트폴리오 관리**: 보유 종목 실시간 조회 및 수익률 자동 계산
* **🛡️ 안전 보장 시스템**: 3단계 보안 락(종목별/세마포어/전역) 및 포괄적 오류 처리

---

## Release 2: 매수 기준 완화 및 모멘텀 전략 강화

### 🎯 변경 목적
기존의 극도로 보수적인 가치투자 방식으로 인해 매수 실행율이 너무 낮아, 좋은 투자 기회들을 과도하게 놓치는 문제를 해결하고자 합니다.

### 🔄 주요 변경사항
**1. 매수 점수 기준 합리화**
* 기본 매수 점수: 8점 → 7점으로 완화
* 포트폴리오 70% 이상 시: 9점 → 8점으로 완화

**2. 프롬프트 개선**
* 에이전트 정체성: "매우 보수적" → "신중하되 모멘텀 고려"
* 매수 점수 해석 기준 조정:
  * 6점: "보통 (모멘텀이 있다면 고려)" 추가
  * 7점: "양호한 매수 기회"로 진입 가능
* 적합성 판단 질문 개선:
  * 기존: "과매도 상태로 매수 적기인가?" (역추세적)
  * 신규: "거래활동 증가나 관심 상승을 보이는가?" (순추세적)

**3. 모멘텀 요소 강화**
* 거래량 급증 시 긍정적 평가
* 투자자별 거래량에서 기관/외인 순매수 시 가산점

### 📊 기대 효과
* 매수 실행율 증가 예상
* 상승 모멘텀 있는 종목들의 기회 포착 개선
* 기존 가치투자 안전장치는 그대로 유지

### ⚠️ 리스크 관리
* 기본적인 재무 건전성, 성장성 검토는 여전히 필수
* 포트폴리오 다양성 제약 조건 유지
* 손절매 시스템 그대로 유지

---

## Release 1: 초기 기능 및 커스터마이징

### 🎯 지원하는 기능
**급등주 포착 조건 예시**
* **거래량 급증** (전일 대비 200% 이상)
* **갭 상승** (5% 이상)
* **시가총액 대비 거래대금 비율**
* **마감 강도 분석**

**분석 보고서 구성**
* **핵심 투자 포인트** - 요약
* **기술적 분석** - 차트 및 지표
* **기본적 분석** - 기업 현황/개요
* **뉴스 분석** - 최근 이슈
* **투자 전략** - 매매 전략

### 🔧 커스터마이징
* **급등주 기준**: `trigger_batch.py`에서 수정 가능
* **AI 프롬프트**: `cores/agents/`에서 에이전트별 수정
* **차트 스타일**: `cores/stock_chart.py`에서 시각화 커스터마이징